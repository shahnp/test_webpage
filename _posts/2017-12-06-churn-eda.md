---
title: "NYC_Project The Flights Dataset"
author: "Pankaj Shah"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output:
revealjs::revealjs_presentation:
incremental: true
self_contained: false
reveal_options:
slideNumber: true
previewLinks: true
fig_width: 7
fig_height: 6
fig_caption: true
pdf_document:
fig_caption: yes
highlight: haddock
keep_tex: yes
pandoc_args: --listings
toc: yes
df_print: paged
xaringan::moon_reader:
yolo: true
nature:
autoplay: 30000
header-includes:
template: ' theme / report-template.tex '
html_document:
toc: yes
geometry: left = 0.5cm, right = 1cm, top = 1cm, bottom = 1cm
---

# Group 2 Project:
Instructor: LESSIA SHAJENKO

ALY 6040- 71233 DATA MINING APPLICATIONS
FALL 2018 CPS
PROPOSAL DRAFT
TEAM: FLIGHT ANALYST:

Northeastern University



# Main Outcome of this notebook:

By following the steps and running this notebook in your laptop, you will be able to understand and explore flights that were departed from the three major New York City airport in 2013. We will also generate and do graphical and statistical analysis along the ways to address why were their delays in the flight. If you follow the code and knit this file in pdf you will be able to learn the indispensable skills of data processing and subsetting. So happy Learning and exploring in the built datasets.


# Introduction:

In our lifetime we likely have all flown on airplanes once or many times. Or we might have known someone who has flown the plane, not a pilot but a traveler. One thing we hear from most of the travelers is about the planes getting delayed or canceled because of many factors besides weather and mechanical conditions. We also have witnessed many times in news the plane making Emergency Landing because of Failed Mechanical Components. We have also encountered frequently that some flights are delayed because of a variety of conditions from certain airports. As a data anlayst, we always try to understand if there are any ways we could avoid having to deal with these flight delays. If we have data available could we make sense of all these delays or a certain time of year we should avoid trying to fly? Throughout this project, I am going to analyze data related to flights which are contained in the nycflights13 package (Wickham 2018). It is easy to download in R studio and not hard to find. Specifically, when we download into R workspace from the library this package contains five datasets saved as “data frames”. The nycflighsts datasets contain the information mostly about all domestic flights departing from Big Apple(New York City) in the year 2013. From the datasets, we can get the information about the airports. 


There are three airports.

- **Newark Liberty International (EWR)** <br>
- **John F. Kennedy International (JFK)** <br>
- **LaGuardia (LGA) Airports** <br>

The **flights** data frame is the main dataset in the package not only contains detailed information for all the flights that had departed from NYC in the year 2013 but also information about **airlines**,**airports** and **weather**.  It is pretty good datasets to analyze and understand a little bit about the Aviation industry and datasets is real world example itself from New York.


New York City ranks just above the middle of the pack for both average snowfall (23 inches per snow season) and days with measurable snow in a year (14 days). Despite that, snowstorms can cripple air travel for a full day or longer at this airport, as well as the major airports nearby. Snowstorms aren’t the only factors that trigger delays. Frontal systems can also cause delays when they’re accompanied by low clouds.Of the New York area’s three major airports, JFK saw the fewest arrivals in the time period we studied, but there were more than enough delays to vault this hub into our top 10.

**Information about the nycflights package:** 

The package was created on June 22th, 2014, by Hadley Wickam.(Remember that name). Every data Analyst or Data Scientist who works in R knows him. For more details regarding the package, please refer to the [nycflights13 introduction page](http://cran.r-project.org/web/packages/nycflights13/nycflights13.pdf). 

**Goals and Outcomes of this project:**

We will together explore the data sets in the 'nycflights13' package to find out about the flight delays, cancellation, trends, insights and uncover interesting anomalies regarding traffic volume across airline carriers as well as the three different airports. The datasets are easier to understand and a lot of things can be done using the datasets. So I am excited about the project. Let's dive deeper and explore the unseen journey of nycflights13.

# Datasets Description <br>
**Info about Datasets** 

- flights: information on all `dim` dimension flights.
- airlines: translation between two letter IATA carrier codes and names (16 in total)
- planes: construction information about each of 3,322 planes used.
- weather: hourly meteorological data (about 8705 observations) for each of the three NYC airports
- airports: airport names and locations.

Sourceof the original data: RITA, Bureau of transportation statistics

• http://www.transtats.bts.gov/DL_SelectFields.asp?Table_ID=236

**Lets first start to check all the packages that we need to run and analyse this whole workbook.** <br>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, size="small", tidy.opts=list(width.cutoff=60),tidy= FALSE, global.par = TRUE)
# display code as typed
# slightly smaller font for code
```

```{r}
webshot::install_phantomjs() #this following code helps to convert it in pdf document nicely
```

These is the session info of these R codes. Check for the specific package and the library version if you run  into any of the issues.
```{r}
sessionInfo()
```

Check for the specific packages in your specific Laptop. 
```{r}
if(!require(dplyr)) install.packages("dplyr")
if(!require(ggplot2)) install.packages("ggplot2")
if(!require(nycflights13)) install.packages("nycflights13")
if(!require(grid)) install.packages("grid")
if(!require(vcd)) install.packages("vcd")
if(!require(readr)) install.packages("readr")
if(!require(moderndive)) install.packages("moderndive")
if(!require(kableExtra)) install.packages("kableExtra")
if(!require(lubridate)) install.packages("lubridate")
today <- Sys.Date()
today
```

# Library 
Load helpful necessay packages. 
```{r, load_libraries, warning=FALSE, message=FALSE}
library(ggplot2)
library(dplyr)
library(nycflights13) # Our datasets is coming from these library
library(pander)
library(grid)
library(vcd)
library(readr)
library(moderndive)
library(kableExtra)
library(statsr)
library(lubridate)
library(geometry)
library(rticles)
library(revealjs)
```
**Dimensions** <br>

The following code will display the dimension of our datasets as it is very important to know how big your data is even before we dive in. Each observation (row) that we see below in the **flights** data frame represents a separate flight originated from one of the three airports from the New York City in the year 2013.

**Structure of Flights datasets** 
```{r}
str(flights)
```
# Data Dictionary <br>
From the above outputs. Let's understand the column names which will help us to diagnose the data much easier.<br>
The *column names*  and *column descriptions* are given below: 

**First Three column names** 

- **year, month, day**  -  Date of departure (DATETIME)<br>
- **dep_time** -  Departure time, in minutes *in local time zone* <br>
- **sched_dep_time** - Scheduled Departure time, in minutes *in local time zone* <br>
- **dep_delay** - Departure delays, in minutes *Negative times represent early   departures/arrivals* <br>
- **arr_time** - Arrival Time, in minutes *These are in local time zone* <br>
- **sched_arr_time** - Scheduled Arrival, in minutes time *in local time zone* <br>
- **arr_delay**  - Arrival delays, in minutes. *Negative times represent early arrivals* <br>
- **hour, minute**  -  Time of departure broken in to hour and minutes <br>
- **carrier**  -  Two letter carrier abbreviation. **For more detail refer to airlines datasets to get the names**  <br>
- **tailnum** -  Plane tail number (Every plane has its unique TailNum) *Think as a Licensce Plate Number of each vehicle* <br>
- **flight**   -  Flight number (Unique Number for each flight) <br>
- **origin**   -  Origin (One Aiprot out of Three) . See  **airports**  data set for additional metadata <br>
- **dest** - Final Destination <br>
- **air_time** -  Amount of time Plane has spent in the air. Starting from origin to reach the final Destination. <br>
- **distance**  -  Distance travelled  <br>

An example of the observations is shown as follows: <br>
Lets look at first observation of the data.First observation that has been recorded in our datasets. <br>

# Information about the datasets.
```{r}
df_info <- function(x) {
data  <- as.character(substitute(x))  ##data frame name
size <- format(object.size(x), units="Mb")  ##size of data frame in Mb

##column information
column.info <- data.frame( column        = names(sapply(x, class)),
#class         = sapply(x, class),
unique.values = sapply(x, function(y) length(unique(y))),
missing.count = colSums(is.na(x)),
missing.pct   = round(colSums(is.na(x)) / nrow(x) * 100, 2))

row.names(column.info) <- 1:nrow(column.info)

list(data.frame     = data.frame(name=data, size=size),
dimensions     = data.frame(rows=nrow(x), columns=ncol(x)),
column.details = column.info)
}
Sys.timezone() # Will Display Time zone of your zone
```
# Information about the Airlines
```{r}
df_info(airlines)
```
# Information about the Weather
```{r}
df_info(weather)
```
# Information about the Airports
```{r}
df_info(airports)
```
# Information about the flights
```{r}
df_info(flights)
```
# Head of Flights datasets
```{r}
head(flights, 1) %>% table()
```
**Interpretation:** 

- year : 2013<br>
- month : 1 (JAN)<br>
- day : 1st
- dep_time : 5:17 AM( EST)
- sched_dep_time : 5:15 AM (EST)
- dep_delay : -2 (Negative 2 Min i.e 5:15AM - 5:17 AM) Departed early before Scheduled.
- arr_time : 8:30 AM
- scheduled_air_time : 8:19 AM
- arr_delay : 11 Minutes (8:19- 8:30 AM)
- carrier : UA
- flight : 1545
- tailNum : 14228
- Origin : EWR(Newark Liberty International)
- dest : IAH
- air_time : 227 Minutes i.e 2 HR 27 Minutes. (8:30 - 5:17)
- distance: 1400 Miles
- HR & Min: 5 Hr 15 Minutes.

**WORD ANALYSIS**

- For Example The flight # 1545 is The United Airlines flight (tail NUM: 14228) which originated from Newark Liberty International(EWR) airport in New York, NY flew to George Bush Intercontinental Airport (IAH) in Houston Texas on January 1, 2013 departing at 5:17 am (EST) and arriving at 8:30 AM (CST). It flew a distance of 1400 miles for 2 hours and 27 minutes, spending in the air minutes and leaving EWR airport earlier than the scheduled time by 2 minutes. Arrived at Houston Airport 11 Minutes in delay than scheduled flight.

# Flights Dataset preparation:


# Q1.TOP 10 carriers from all three airports. <br>
```{r}
flights_table <- flights %>% 
group_by(carrier) %>%
summarise(number = n()) %>% 
arrange(desc(number)) %>% top_n(10)

flights_table$carrier <- as.factor(flights_table$carrier)
flights_table$number <- as.numeric(flights_table$number)
flights_table
```
**ANALYSIS**

We see that UA flew most from all three airports [58665]. Below we will plot in descending order.<br>
```{r}
ggplot(flights_table, aes(x=reorder(carrier,-number), y=number)) +
geom_bar(stat="identity") + 
labs(x="Carrier", y="Number of Flights")+
ggtitle("Top 10 Carriers from three airports.") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") + 
theme(
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#1E1E20",face="bold.italic" ),
plot.title = element_text(color="#D70026", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
**ANALYSIS**

From the above barplot, we can conclude that United Airways(UA) has done more flights from all three airports combined. Followed by Jet Blue (B6) & (EV).

# Basic Data Exploratory
Lets do some basic data Exploratory Analysis before we dive into detail.
```{r}
basic_eda <- function(data)
{
library(Hmisc)
library(funModeling)
library(tidyverse)

#profiling_num(data) 
#plot_num(data)
#describe(data)
#df_status(data)
#glimpse(data)
freq(data)
sapply(data, function(x) sum(is.na(x)))
}
```

```{r message = FALSE, warning= FALSE}
options(max.print = 100)
basic_eda(flights)
```
# Q2. Descrptive Analysis of Flights Datasets.
**Lets breakdown the individual elements**
```{r}
# Describe the flights data by each columns to get Insights
describe(flights)
```

**Visual Representation of Datasets**
```{r warning= FALSE}
# Attributes which are not identical across measure variables will be dropped.Also all biwidht must be positive.
plot_num(flights)
```
Lets check the status of our datasets. Let us provide indepth knowledge of missing datasets.

# DF status of Flights
```{r}
df_status(flights) # Its good for analysing Missing datasets and to spot unique numbers.
```
As we have seen that we have missing datasets in the number of columns. We need to address those variables before we diagnose our flights' datasets.

# Handling the Missing datasets
```{r}
print(" The number of missing values in Flights datasets is ")
sapply(flights, function(x) sum(is.na(x)))

print("The number of missing values in Airlines datasets is")
sapply(airlines, function(x) sum(is.na(x)))

print(" The number of missing values in Airports datasets is ")
sapply(airports, function(x) sum(is.na(x)))

print(" The number of missing values in Weather datasets is ")
sapply(weather, function(x) sum(is.na(x)))
```
**MISSING DATA ANALYSIS**

- In Flights datasets we have 
+ dep_time : 8255 Missing data
+ dep_delay : 8255 Missing data
+ arr_time : 8713 Missing data
+ arr_delay : 9430 Missing data
+ tailnum : 2512 Missing data
+ air_time : 9430 Missing data

- We don't have any Missing data in Airlines datasets.

- We don't have any Missing data in Airports datasets.

- In Weather datasets we have:

+ temp : 1 Missing data
+ dewp : 1 Missing data
+ humid : 1 Missing data
+ wind_dir : 460 Missing data
+ wind_speed : 4 Missing data
+ wind_gust : 20778 Missing data
+ pressure : 2729 Missing data<br>

Just for simplicity purpose (quick and dirty analysis), We will omit all the missing datasets to get the gist of Exploratory Data Analysis but while building upon the model or making a coorelation assumption as well as doing more detail linear Regression we will take care of these missing data in detail effort. For now let's drop the missing datasets.

```{r}
flt_1 <- flights %>% na.omit()
# Sanity check
sum(is.na(flt_1))
# Detail Sanity check
sapply(flt_1, function(x) sum(is.na(x)))
```
We can Confirm that the "flt_1" datasets we just created from flights datasets don't have any missing datasets in it. we have dropped rows from the original datasets. Sanity check was run through.

After Handling the missing data we can work with the datasets. So lets dive have a glimpse of our datasets and fix its class so that we can easily explore datasets without any hickups.
```{r}
glimpse(flt_1)
```
# Type Conversion
```{r}
#convert the types of existing variables from character to factor and store back to its datasets.
flt_1$carrier<-factor(flt_1$carrier)
flt_1$tailnum<-factor(flt_1$tailnum)
flt_1$origin<-factor(flt_1$origin)
flt_1$dest<-factor(flt_1$dest)
```
# Join 

**Flights datasets with Airliness, Airports**

Let's create one dataset with all the necessary information. We have a dataset with carrier name but we are missing its full acronym, which can be founded in airlines datasets. Below in these codes, we will join flt_1 with airlines' datasets.

```{r message = FALSE, echo= FALSE, warning= FALSE}
# Join flt1 with airlines datasets
flt_1 <- left_join(flt_1, airlines, by = NULL, copy = false) # The reason for doing by = NULL as we don't have any common columns but the elements inside can be replicated. We are recoding with the acronym.
colnames(flt_1) # Sanity check that name has been imported to our flt_1 datasets.
flt_1 <- rename(flt_1, "carrier_name"= "name") # Renaming the column name "name" to "carrier_name". "name" is coming from the airliness datasets.
# colnames(flt_1) # Uncomment to see the name has been changed.
```

After we have successfully joined flights datasets with the Airlines's datasets. We can similarly do with Airports datasets. Let's look at the column name of airport datasets. Here We have faa code given to each airport which can be matched with airports origin and destination. 

```{r}
colnames(airports)
# unique(airports$faa) #  Uncomment it see all the unique airports faa code.
```

```{r warning= FALSE}
# Left join faa code with destination.
flt_1 <- left_join(flt_1, airports , by = c("dest" = "faa"), copy = false)
#colnames(flt_1) # Uncomment to do sanity check.
flt_1 <- rename(flt_1, "arrival_airport"= "name") # change name which is coming from airports to arrival_airport.

# Left join faa code with origin.
flt_1 <- left_join(flt_1, airports , by = c("origin" = "faa"), copy = false)
#colnames(flt_1) # Uncomment to do sanity check.
flt_1 <- rename(flt_1, "departure_airport"= "name") # change name which is coming from airports to arrival_airport.

#colnames(flt_1) # Uncomment to do sanity check.
glimpse(flt_1) # Lets have a look to our datasets, confirm everything has been imported as we wish for. 
```
# Factor Conversion

For calculations purpose, we will convert the following variables to factor. i.e. carrier_name, departure_airport, origin, arrival_airport so that we can do basic calculations.

```{r}
flt_1$carrier_name<-factor(flt_1$carrier_name)
flt_1$departure_airport<-factor(flt_1$departure_airport)
flt_1$origin<-factor(flt_1$origin)
flt_1$arrival_airport<-factor(flt_1$arrival_airport)
flt_1$month <- factor(flt_1$month)
```
Flight delays due to weather are an unfortunate reality, especially at some of the busiest airport hubs in the United States.After we have done all these type conversions and fixing our datasets without any missing data. Our datasets are ready to get explored. So without any delays, let's jump into Exploratory Data Analysis. First Lets break down the casual delay by Season. We would like to know if the delays are common in all season or it is only in one season. We have month datasets so we will convert month into the season according to a standard Calendar month and see if there are any Seasonal delays.

# Q3. Departure delay by Season 
```{r}
#create seasons
flt_1<- flt_1 %>% mutate(Season = ifelse(month %in% c(6,7,8), "Summer",
ifelse(month %in% c(9,10,11), "Fall",
ifelse(month %in% c(12,1,2), "Winter",
"Spring"))))
table(flt_1$Season)
# Boxplot 
boxplot(formula = dep_delay ~ Season,
data = flt_1,
main = 'Departure delay by Season',
xlab = 'Season',
ylab = 'Departure delay [min]',
border = c('springgreen', 'indianred1', 'orange', 'skyblue'),
names = c('Spring', 'Summer', 'Fall', 'Winter') +
theme_dark()+
theme(
plot.title = element_text(color="red", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold")))

aggregated_mean_sd_median <- cbind(
mean = aggregate(formula = dep_delay ~ Season,
data = flt_1,
FUN = mean, 
na.rm = T),
sd = aggregate(formula = dep_delay ~ Season,
data = flt_1,
FUN = sd, 
na.rm = T),
median= aggregate(formula = dep_delay ~ Season,
data = flt_1,
FUN = median, 
na.rm = T)
)
aggregated_mean_sd_median 
```

```{r}
# ALT WAY of plotting same graph with geom_boxplot
ggplot(flt_1, aes(x = Season, y = dep_delay)) +
geom_boxplot(color = c('springgreen', 'indianred1', 'orange', 'skyblue'), fill = c('springgreen', 'indianred1', 'orange', 'skyblue')) +
scale_y_continuous(name = "Departure Delay [Min]",
breaks = seq(0, 1400, 200),
limits=c(0, 1400)) +
scale_x_discrete(name = "Season") +
ggtitle("Departure delay by Season") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"),
plot.title = element_text(size = 20, hjust = 0.5, color = "red", face="bold.italic"),
text=element_text(size = 16),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#1E1E20", face="bold.italic"),
axis.text.x=element_text(colour=c('springgreen', 'indianred1', 'orange', 'skyblue'), size = 12),
axis.text.y=element_text(colour="black", size = 12))
```
**ANALYSIS**

As we can see from above boxplot that Delays are consistent across the season. During the Winter month, we can see there are some flights which are delayed longer compare to summer, fall and spring. During the Spring the delays are a lot smaller. But overall it's not Seasonal, there are various factors that cause delays besides the weather in winter months. One of the interesting observation we could take from the above graph is why there are delays in the Summer month. When the East Coast Weather is so perfect, no snow storm and weather is getting better. Why are there delays? Let's break down our Seasonality effect to month so that we can see if there is any particular month that has more delays than others.

# Q4. Departure Delay across Month in all three airports.
```{r}
ggplot(flt_1, aes(x = month, y = dep_delay) ) + 
geom_point(alpha = 0.3, color = 'steelblue') +
labs(x="Dep_delay", y="Months", 
caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
ggtitle("Departure Delay across Month") +
theme(
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#1E1E20",face="bold.italic" ),
plot.title = element_text(color="#D70026", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))+
coord_flip()
```
**ANALYSIS**

Departure delay is equally distributed among all the months. In these plot its really hard to see a huge difference between the months. We can see in some months there are huge delays because of the presence of many outliers but in some months there are less. In the month of January, we can see some outliers are data are fairly spread out. It seems like month June(6th) July (7th) is more densely blue than rest of month. Let's plot another plot where we can see these difference much clear way.

```{r}
t_subset_flight <- subset(flt_1, !is.na(dep_delay), !is.na(arr_delay)) 
ggplot(aes(x = dep_delay), data = subset(t_subset_flight, dep_delay >= 0 & dep_delay <= quantile(dep_delay, .90) ) ) +
geom_histogram(aes(fill = carrier), binwidth = 1) + 
facet_wrap(~month)+ # break down by carrier.
ggtitle("Departure Delay across Month") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#1E1E20",face="bold.italic" ),
plot.title = element_text(color="#D70026", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))

```
# Q5.Departure Delay across months Statistical Analysis

```{r}
flt_1 %>%
group_by(month) %>%
summarise(mean_dd = mean(dep_delay)) %>%
arrange(desc(mean_dd))
```
# Q6. Which month has the highest average departure delay from an NYC airport?
- July
- June
- December

July, followed by June is the month with the highest average delay of flights departing from an NYC airport. A high average mean of delay has also observed in December, suggesting that the problem lies in the number of flights during the Holidays. The months with the lowest average of departure delays are September to November.

# Q7. Departure Delay Across Month and days.
```{r}
subset_flight <- subset(flt_1, !is.na(dep_delay), !is.na(arr_delay)) 
ggplot(aes(x = day, y = dep_delay), data = subset_flight ) +
geom_point(alpha = 0.04, color = 'brown') + 
ggtitle("Departure delay across  all month and days between all Airlines.") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
plot.title = element_text(color="red", size=14, face="bold.italic", hjust = 0.5),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#1E1E20", face="bold.italic"),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))+
facet_wrap(~month)
```
# Q8. Departure Delay across Carrier

Lets also breakdown the analysis by carrier so that we can see if these is across all airlines.
```{r}
ggplot(aes(x = dep_delay), data = subset(subset_flight, dep_delay >= 0 & dep_delay <= quantile(dep_delay, .90) ) ) +
geom_histogram(aes(fill = month), binwidth = 1) + 
facet_wrap(~carrier)+ # break down by carrier.
ggtitle("Departure Delay across Carrier") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#1E1E20",face="bold.italic" ),
plot.title = element_text(color="#D70026", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))

```
**ANALYSIS** 

- Major contributor :
- AA : American Airliness.
- B6 : Jet Blue Airliness.
- DL : Delta Airliness.
- EV : Express Jet lines
- UA : United Airliness (Biggest Contributor) 

Seems reasonanble as it does more flights than others.

As it is clear from the above graph that we are seeing more delays in the month of June and July. We also can see which carrier is playing the major role in causing such delays. Below I will plot the Histogram plot to see the break down of those two months.

# Q9. Departure Delay in June & July

```{r}
# Histogram plot for June 
June <- subset(flt_1, month == 6)
June <- subset(June, !is.na(dep_delay), !is.na(arr_delay))

ggplot(aes(x = day, y = dep_delay), data = June ) +
geom_point(aes(color = carrier))+
ggtitle("Departure delay across month of June between all Airlines.") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
plot.title = element_text(color="red", size=14, face="bold.italic", hjust = 0.5),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#1E1E20", face="bold.italic"),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))

# Histogram plot for July
July <- subset(flt_1, month == 7)
July <- subset(July, !is.na(dep_delay), !is.na(arr_delay) )

ggplot(aes(x = day, y = dep_delay), data = July ) +
geom_point(aes(color = carrier))+
ggtitle("Departure delay across month of July between all Airlines.") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
plot.title = element_text(color="red", size=14, face="bold.italic", hjust = 0.5),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#1E1E20", face="bold.italic"),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
**ANALYSIS**


It is clear from both charts that delay was not specific in one day but across the month. Still, these datasets we have is not just enough to make any prediction or statements but after looking at the datasets we can surely say that between June and July there are huge delays.

# Q10. Relationship between arr_delay and dep_delay.

Lets see if there is any relationship between arr_delay and dep_delay in our datasets.
```{r}
ggplot(subset_flight,aes(x = dep_delay, y = arr_delay)) +
geom_point(aes(color = carrier), alpha = 0.6)+
geom_smooth(method= lm)+
ggtitle("Relationship between Arrival and Departure delays") +
theme(
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="green", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
**ANALYSIS**

From the above plot, we can see there is a linear relationship between arrival delay and departure delays among all the carriers and across all the airports.

After quick and dirty analysis we will tweak our model a little bit and see if the delays are not marginal. Till now if the arrival and departure of the airlines are not on schedule then we are simply calling it delays but if we normalize our datasets we can make our analysis much better. So to do that let's calculate mean and median of departure delays across all the carriers in one plot.

# Q11. Mean and Median departure delay across all the carriers

```{r}
# It will take atleast 5 minutes to run this code. [ BE PATIENCE !!! ]

ggplot(subset_flight,aes(x = carrier, y = dep_delay))+
geom_point(color = 'red', stat = 'summary', fun.y = mean) +  # MEAN
geom_point(color = 'blue', stat = 'summary', fun.y = median)+ # MEDIAN
geom_hline(aes(yintercept = mean(dep_delay, na.rm = TRUE)), color = 'red')+
geom_hline(aes(yintercept = median(dep_delay, na.rm = TRUE)), color = 'blue')+
ggtitle("Mean and Median departure delay across all the carriers") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
geom_text(aes (x = 1, y = 14), label = "MEAN", hjust = 0, color = 'red', fontface = "bold")+
geom_text(aes (x = 1, y = 0), label = "MEDIAN", hjust = 0, color = 'blue', fontface = "bold")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
**ANALYSIS**

After looking at the variance of the datasets we can see that there is quite a difference between Mean and Median across all the airlines. 

Lets calculate mean delay:
```{r}
mean(flt_1$dep_delay, na.rm = TRUE)
```
**What is our cut off point. What should be consider late  or early delays** <br>

We can pick based on average mean which cames out to be 12.55 as a baseline. As it is not standard anything beyond its scheduled arrival is delayed the flight. But in our datasets, we can wiggle a little bit to pick one cut offline and we can bin the flights into respective variables, I think this would be the way to do it. 

In Summary, we will Create a categorical variable for departure delay (dep_delay), which we consider to be departure status. Departure delay is a continuous variable capturing the difference in minutes between the expected and actual departure times. The new variable which we generated classifies the delay into 3 discrete levels: Early (up to 0 minutes of delay), On time (up to 13 minutes of delay), and Late (above 13 minutes of delay).


```{r}
flt_1$dep_status <- flt_1$dep_delay # slicing dep_delay to dep_status. I can do mutate.
flt_1$dep_status<- ifelse(flt_1$dep_status < 0,'Early', # Recoding 
ifelse(flt_1$dep_status < 13,'On Time','Late'))
flt_1$dep_status<-factor(flt_1$dep_status) # type conversion
table(flt_1$dep_status) # Better if we have prop table.
```
**ANALYSIS**

There were more early flights compare to Late and On- time flights. From the above table, we can say that must flights seems to be early if they have an early departure. We will dive into Late flights further down but we can see that when we change our baseline we see the huge improvement in Early and On-time departure delay airlines.

# Q12. Spotting the Outliers in Late Flights.

The graph below was generated to ensure that the new *categorical* variable matches the original *factor* variable:**Also we can visually spot some outliers in late arrival column which are more than 1000 Minutes** We will diagnose all those variables later to see the casual inferences. We can see that most of the late flights are dense between 0 to 500 Minutes and then it starts to disperse and then we see some heavy outliers around 1300 Minutes.

```{r}
ggplot(flt_1, aes(x=dep_delay, y=factor(dep_status))) +
geom_point(aes(color=factor(dep_status)))+
ggtitle("Departure Status of the dep_delays flights")+
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),  color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))

```

Let's look at one more perspective if flights are arriving in the airport on time. We can take mean to get the sense of the data.

```{r}
mean(flt_1$arr_delay, na.rm = TRUE)
```

Similarly, as we wiggle our baseline for departure delays we can do similarly for the arrival delays. We will create a categorical variable (arrival status) for arrival delay (arr_delay) with levels: Early, On time, and Late. In creating this variable, we followed the same approach as that used for the departure delay variable above.

```{r}
flt_1$arr_status <- flt_1$arr_delay
flt_1$arr_status<- ifelse(flt_1$arr_status < 0,'Early',
ifelse(flt_1$arr_status < 6.9,'On time','Late')) # taking Mean as On_time baseline.
flt_1$arr_status<-factor(flt_1$arr_status)
table(flt_1$arr_status) # prop.table to do analysis.
```
**ANALYSIS**<br>

The graph below was generated to ensure that the new *categorical*  variable matches the original *factor* variable as we did above for the arrival. Keeping it consistent. We can see a small fraction of planes arrive on time, there are more planes that arrive early.

```{r}
ggplot(data=flt_1, aes(x=arr_delay,
y=factor(arr_status))) +
geom_point(aes(color=factor(arr_status)))+
ggtitle("Arrival Status of arr_delay flights")+
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

# Q13. Variable Summaries

A statistical summary of all the variables within our dataset was generated below using the 'summary' command in R:
```{r}
summary(flt_1)
```
While the information above provides a high-level introduction to the data set, the sections below shall focus on specific analyses of the 'flights' data set. 

# Q14. Analysis by flight volume:

A high-level view of the flight volumes coming out of the NYC area is displayed below:
```{r}
print("Number of flights flown away from given three airports:")
sort(xtabs(formula = ~ departure_airport, data = flt_1), decreasing = TRUE)
```
**ANALYSIS**<br>

It seems like an almost equal number of flights flew away from all these three airports as there are small marginal changes between these three airports. As La Guardia airport seems to have fewer flights than other two maybe because of being domestic Airport compare to two other International Airports with international flights.

While the three airports manage similar volumes, Newark Liberty international airport is in the lead. We shall now drill down into the volume data, looking at flight traffic from different perspectives.

# Q15. Flight volume over time

The flight count by month is displayed below:

```{r}
ggplot(flights) + 
aes(x=factor(month)) +
geom_bar(aes(fill=factor(month))) +
scale_colour_brewer(palette = "Set1")+
theme_dark()+
ggtitle("Flight volume over time")+
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))+
coord_flip()
```
**ANALYSIS** 

What we observe is flights throughout the year remains consistent with a little dip in the month of February(2nd) which I believe because of Northeaster Weather. We will dig into that components later when we once merge our datasets with Weather data and see the number of cancellation in each month of the year and by airlines. Most of the flights are during the summer season where the cancellation due to weather seems less. But that is another can of worms which we will dig into it later on.

The output shows that the number of flights each month appears to be consistent and closely follows the number of days in each month. It indicates that the number of flights stays consistently within days. Our finding will be underscored by the output of counting a number of flights within days (ranging from 1 to 31) which is shown below:

```{r}
ggplot(flights) + 
aes(x=factor(day)) +
geom_bar(aes(fill=factor(day)))+
scale_colour_brewer(palette = "Set1")+
theme_dark()+
ggtitle("Flight volume over time breaking down by days")+
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))+
coord_flip()
```
**ANALYSIS** 

29th and 30th seem less flown date. 31st makes total sense as we can have 31st in calendar only half of time. Also, We don't have a dataset of our tickets so it will be a little hard to draw a conclusion just based on these bar plots. But in the ideological world, if there was an equal number of flights offered from all these three airports across the given days. People tend to fly less towards the end of the month but by not much. If we pay close attention we can see that from 23 it starts to dip but these could be totally due to the availability of flights and other unseen factors. 
# Q16.Flight volume by flight distance.

The following bar chart shows the number of flights grouped by flying distance, which helps indicate the type of flights departing from NYC( Short-distance domestic, Long-distance domestic, International).
```{r}

ggplot(flt_1, aes(x=distance)) +
geom_bar(aes(color=1)) + guides(color=FALSE)+
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
ggtitle("Flight volume by flight distance")+
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

As we can see most of the flights are from range 0 to 2800 Miles. There are some long-haul flights around 5000 Miles. We can bin the flights based on good model assumption as short, mid-distance and long-haul flight category. To do that let's take the summary of our flight datasets.

```{r}
summary(flt_1$distance, na.rm = TRUE)
# table(flt_1$distance) # Uncomment to see all the flights for specific distance.
```

```{r}
ggplot(flt_1, aes(x=distance)) +
geom_histogram(aes(color=1), binwidth = 500) + guides(color=FALSE) +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
ggtitle("Flight volume by flight distance ")+ # Using binwidth to split the flights into short,mid & long.
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
**ANALYSIS**

More flights were flown 2nd and 3rd bin. We also see some flights that were flown for more than 4000 Miles(Outliers). These most be international flights or long haul flights. The distance between East coast to West Coast is around 2500-3000 Miles. It must have been flights from New York to Hawaii which is around 5000 Miles.

We set 500 miles as the bin width for this report. The output shows that the highest proportion of flights have distances less than 1500 miles. It indicates that most of the flights are traveling short or mid-distance domestic routes. There's also a considerable number of flights with distances around 1500-2500 miles. It indicates the second most common group of flights is long-distance domestic flights / short distance international flights (The flight distance from NYC to Los Angeles is 2500 miles). Last but not least, there's a little number of flights fall into the range from 4500 to 5000 miles, which indicates that the long-distance international flights only count for a small proportion of the total flights departing from NYC.
Generating the same chart, while taking the different departure airports into account, results in the following output:
```{r}
ggplot(flt_1, aes(x=distance)) + 
geom_bar(aes(fill=factor(origin)), binwidth = 500) + 
guides(color=FALSE)+
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
ggtitle("Flight volume by flight distance segregated by Airports")+ 
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
**ANALYSIS** 

- EWR : RED
- JFK : GREEN
- LGA : BLUE

A higher proportion of short and mid-distance flights. A very small proportion of long distance but hard to visualize as they stack on top of one another. LGA is not international terminal.LaGuardia is the busiest airport in the United States without any non-stop service to Europe.  Laguardia doesn't have any International arrivals because the runways are shorts.

# Q17. Flight volume by carrier
Below is a table showing flight volume by departure airports and carrier airlines.
```{r}
xtabs(formula = ~ carrier_name + departure_airport, data = flt_1)
```
** Observations ** 
-  Airtran, Mesa ,Frontier only fly from LaGuardia.<br>
-  Alaska only flew from Newark Liberty Intl <br>
-  Hawaiian only flew from JFK. <br>
-  Skywest only flew 6 times through newark that is the lowest and 23 from LGA both are lowest. <br>
- United airways flew most 45,501 planes from Newark Liberty Intl<br>

- Frequencies of airports for each airline companies to depart from. 
- UA (United Airlines) is the biggest number of airlines in 2013. 
- Lots of flight departed from Newark Liberty International Airport (EWR).

**Also remember JFK and Newark are International terminal whereas LGA is domestic airport**
```{r}
colnames(flt_1)
```

# Q18. Flight volume by destination
The table below shows the top 10 destination airports for flights departing from the NYC area:
```{r}

flt_by_dest <- flt_1 %>% 
group_by(arrival_airport) %>%
summarise(dest_count = n()) %>% 
arrange(desc(dest_count)) %>% top_n(10)
flt_by_dest

ggplot(flt_by_dest, aes(x=reorder(arrival_airport,-dest_count), y=dest_count)) +
geom_bar(stat="identity", fill = rainbow(10)) + 
ggtitle ("Top 10 Destination by Flight Volume") +
theme(legend.position="top") +
theme_dark() +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))+
coord_flip()
```
**ANALYSIS**

+ ATL : Hartsfield Jackson Atlanta Intl : Hub connecting many other flights so it makes sense.
+ ORD : Chicago Ohare Intl : Hub connecting to Lots of Midwest and the West coast flights so make sense.
+ LAX : Los Angeles Intl :  West Coast direct flight so make a sense.
+ BOS : General Edward Lawrence Logan Intl
+ MCO : Orlando Intl : Tourism Spot
+ CLT : Charlotte Douglas Intl : Interesting why Charlotte. 
+ SFO : San Francisco Intl : West Coast flights same as people leaving for toursism. Direct flight is advantage.
+ FLL : Fort Lauderdale Hollywood Intl : Florida Tourism spot
+ MIA : Miami Intl : Tourism Spot
+ DCA : Ronald Reagan Washington Natl : Tourism as well as political ( Washigton DC)

**Largest number of flights are on domestic routes (Boston  being one of them, Chicago can be included but i might say it might be connecting hub to west coast as well as Midwest flights)**

# Q19. Flight volume by departure airport

+ Analysis by carrier

Below is a summary showing the relationship between departure airports and carrier airlines.
```{r}
xtabs(formula =~ carrier_name + origin, data = flt_1)
ggplot(flt_1,  
aes(x=factor(carrier))) + 
geom_bar(aes(fill= factor(departure_airport)))+
ggtitle ("Flight volume by departure airport") +
theme(legend.position="top") +
theme_dark() +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
**ANALYSIS**

It coorelates to our findings as well where the flight volume by flight destination that we observed above.
-  Newark is Hub for UA as well as EV.
-  HA only flew to JFK.
-  F9, FL only to La Guardia.

**UA has departed the biggest number of airlines in 2013. And major flights departed from EWR**

# Q20. Summary showing the flight volumes by departure airports across months:
```{r}
xtabs(formula = ~ month + departure_airport, data = flt_1)
ggplot(flt_1) + 
aes(x=factor(month))+ 
geom_bar(aes(fill= factor(departure_airport)))+
ggtitle ("Flight volumes by departure airports across months") +
theme(legend.position="top") +
theme_dark() +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
**ANALYSIS**

The output indicates that the flight volumes among different airports by month generally remain consistent, however, La Guardia seems to have increased its share of traffic over the other airports in the second half of the year.

```{r}
ggplot(data=flt_1, 
aes(x= factor(month))) +
geom_bar( aes(fill= factor(carrier_name)))+
ggtitle ("Flight volumes by departure airports across months") +
theme(legend.position="top") +
theme_dark() +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))+
coord_flip()
```
**ANALYSIS**

As we see in the analysis that the carrier spread is consistent across month and days. We can see

- variability in the number of Flights among different airlines
- But No clear difference in terms of the proportion of flights across the months.

# Q21. Overall Analysis of deep_delay over the course of the Year [2013-2014].
```{r}
# Write a function to extract using make_datetime.
datetime_func <- function(year, month, day, time) {
make_datetime(year, month, day, time %/% 100, time %% 100)
}

# Filter 
flights_dt <- flt_1 %>% 
filter(!is.na(dep_time), !is.na(arr_time)) %>% 
mutate(
dep_time = datetime_func(year, month, day, dep_time),
arr_time = datetime_func(year, month, day, arr_time),
sched_dep_time = datetime_func(year, month, day, sched_dep_time),
sched_arr_time =datetime_func(year, month, day, sched_arr_time)) %>% 
select(origin, dest, ends_with("delay"), ends_with("time"))

# Plot 
flights_dt %>% 
ggplot(aes(dep_time)) + 
geom_freqpoly(binwidth = 86400)+ # 86400 seconds = 1 day
ggtitle ("Analysis of deep_delay over the course of the year [2013-2014]") +
theme(legend.position="top") +
theme_dark() +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))

```
# Q22. Overall Analysis of deep_delay over the course of the Week.

```{r}
flights_dt %>% 
mutate(wday = wday(dep_time, label = TRUE)) %>% 
ggplot(aes(x = wday)) +
geom_bar(stat="count") +
ggtitle ("Analysis of deep_delay over the course of the Week") +
theme(legend.position="top") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

# Q23. Overall Analysis of deep_delay over the course of the day.
```{r}
flights_dt %>% 
filter(dep_time < ymd(20130102)) %>%  # On 2nd Jan 2013
ggplot(aes(dep_time)) + 
geom_freqpoly(binwidth = 600)+ # 600 s = 10 minutes
ggtitle ("Analysis of deep_delay over the day[Jan 1st- Jan 2nd]") +
theme(legend.position="top") +
theme_dark() +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))

```
# Q24. Overall Analysis of deep_delay over the hour [2013-2014]

```{r}
flights_dt %>% 
count(week = floor_date(dep_time, "week")) %>% 
ggplot(aes(week, n)) +
geom_line()+
ggtitle ("Average departure delays by minute within givin hour.") +
theme(legend.position="top") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
**ANALYSIS**

Average departure delay by minute within the hour. It looks like flights leaving in minutes 20-30 and 50-60 have much lower delays than the rest of the hour.

# Q25. How is the flights scheduled for the given airports?
```{r}
sched_dep <- flights_dt %>% 
mutate(minute = minute(sched_dep_time)) %>% 
group_by(minute) %>% 
summarise(
avg_delay = mean(arr_delay, na.rm = TRUE),
n = n())

ggplot(sched_dep, aes(minute, avg_delay)) +
geom_line()+
ggtitle ("scheduled departure time with arrival Delay.") +
theme(legend.position="top") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
**ANALYSIS** 

If we look at the scheduled departure time we don’t see such a strong pattern.

# Q26. Departur hour by Count

```{r}
flights_dt %>% 
mutate(dep_hour = update(dep_time, yday = 1)) %>% 
ggplot(aes(dep_hour)) +
geom_freqpoly(binwidth = 300)+
ggtitle ("Departure hour by Count") +
theme(legend.position="top") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

# Q27. Relationship between distance and arrival delay

```{r}
ggplot(flt_1, aes(distance, arr_delay, fill = arr_delay))+
geom_point(color = "steelblue") +
ggtitle ("Relationship between distance and arrival delay") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme_bw()+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

```{r}
# breakdown time_hour to year, month, day, hour,min, sec. I will show you both ways of converting date into Weekdays and the Week numbers.
date <- as.Date(flt_1$time_hour, format = "%Y-%m-%d %H:%M:%S" ) # This is old way of doing 
flt_1$weekday <- weekdays(date)
unique(flt_1$weekday)
flt_1$wdays<-ymd_hms(flt_1$time_hour) %>% wday() # This is new way of coding 
unique(flt_1$wdays) # 1 : Sunday by default and 7 : Saturday
flt_1<- flt_1 %>% mutate(week_d = ifelse(wdays %in% c(1,7), "weekend","weekdays")) # converting to wdays & weekend
table(flt_1$week_d) # sanity check
```

# Q28. Was there any difference between Arrival delays on weekends & during the week?

```{r}

print(" For Arrival Delays")
# Aggregate to see how many arr_delay happen during weekdays and weekends.
aggregate(flt_1$arr_delay ~ flt_1$week_d,
FUN = mean, 
na.rm = T)

print(" T-test For Arrival Delays")
t.test(arr_delay~ week_d, data = flt_1)


print(" For Departure Delays ")
# Aggregate to see how many dep_delay happen during weekdays and weekends.
aggregate(flt_1$dep_delay ~ flt_1$week_d,
FUN = mean, 
na.rm = T)

print(" T-test For Departure Delays")
t.test(dep_delay~ week_d, data = flt_1)
```
**ANALYSIS**

Comparison done by T-test.

# Q29. Linear Regression Analysis between two major airliness.

Linear Regression Model for Air time as a function of distance for two major carrier United Airways and Jet Blue.
```{r}
flights_per_carrier <- cbind (Frequency  = table(unique(flt_1$carrier)), 
RelFreq = prop.table (table(unique(flt_1$carrier))))

head(flights_per_carrier, 10) # Will show top 10 table

jet_blue <- subset(flt_1, carrier == 'B6')
united_air <- subset(flt_1, carrier == 'UA')

# Linear Regression 
air_time.lm.jet_blue <- lm(distance ~ arr_time, data = jet_blue)
air_time.lm.united_air <- lm(distance ~ arr_time, data = united_air)

plot (x = jet_blue$distance,y = jet_blue$arr_time,xlab = 'Distance [miles]',ylab = 'Air time [min]',main = 'Air time as a function of distance for two major carrier \n United Airways and Jet Blue',pch=18,col='green')
points (x = united_air$distance, y = united_air$arr_time,pch=22,col='red')
abline (air_time.lm.jet_blue , col = 'darkgreen')
abline (air_time.lm.united_air, col = 'darkred')

legend ('topleft',legend = c('United Airliness', 'Jet Blue'),col = c('red', 'green'),pch = 14)
```

# Q30. Relationship of Time with 3 other dependent variables.

```{r}
#Put the plots next to each other
par(mfrow = c(1, 3))

#First Plot - Distance
plot(x = flt_1$distance,y = flt_1$arr_time,main = "Time and Distance",xlab = "Distance in miles", ylab = "Arrival Time in minutes",xlim = c(0, 4000),ylim = c(0, 600), col = "lightcoral",pch = 18, type = "p",cex = 0.2)
abline(lm(flt_1$arr_time ~ flt_1$distance),col = "black",lty = 1)

# Second Plot - dep_delay
plot(x = flt_1$dep_delay,y = flt_1$arr_time,main = "Time and Departure Delay",xlab = "Delay of departure",ylab = "Arrival Time in Minutes",xlim = c(-33, 1000),ylim = c(0, 600),col = "skyblue", pch = 11,type = "p",cex = 0.5)
abline(lm(flt_1$arr_time ~ flt_1$dep_delay),col = "black",lty = 1)

# Third Plot - arr_delay
plot(x = flt_1$arr_delay,y = flt_1$arr_time,main = "Time and Arrival Delay",xlab = "Delay of arrival",ylab = "Arrival Time in Minutes",xlim = c(-70, 1000),ylim = c(0, 600), col = "cyan3",pch = 11, type = "p",cex = 0.5)
abline(lm(flt_1$arr_time ~ flt_1$arr_delay),col = "black",lty = 1)
```

Below We will create a histogram which will show how many flights were taken in each hour throughout the year.
```{r}
hist(x = flt_1$hour,main = "Flights per hour over the year", xlab = "Hour",ylab = "Number of flights",col = "aliceblue",border = "black",xlim = c(0,24),ylim = c(0,20000),breaks = seq(0,24, by = 1))
abline(v = median(flt_1$hour, na.rm = T),col = "black",lwd = 3,lty = 1)
text(x = 16,y = 20000,labels = "Median", lwd = 2)
abline(v = mean(flt_1$hour, na.rm = T),col = "indianred4",lwd = 3, lty = 1)
text(x = 12,y = 20000, labels = "Mean",lwd = 2,col = "indianred4")
```
+ Choose top three Carriers based on number from three airports interms of flights.  

a. United Airliness (UA)
b. JetBlue(B6)  
c. Express Jet Airliness (EV)

# Q31. Dive deep into three specific Airliness.

```{r}
```

In order to look deeper into our findings, we chose 3 airline companies: 
- United Airlines (UA)
- JetBlue(B6)) 
- Express Jet Airlines (EV) 

out of the 16 carriers that fly out of NYC. The 3 airlines selected are typically categorized into the same market positon: budget airlines, which allows us to meaningfully compare and contrast their performance.
Let's make a subset of budget airlines where we will choose the top three carriers.
```{r}
budget_flights <- flt_1 %>% 
filter(carrier == 'UA'|carrier == 'B6'|carrier == 'EV')
# head(budget_flights) # Uncomment to see the top of the budget airliness.
```
# Q32. Summaries within airports from chosen three flights.

A horizontal comparison among budget airlines within different airports displays the following results:
```{r}
ggplot(data = budget_flights) + 
aes(x= factor(origin)) + 
geom_bar(aes(fill= factor(carrier_name)))
```
**ANALYSIS**

- We can see Jetblue has large share in JFK Airport. 
- Delta has roughly similar number of flights in JFK and LGA but very less from Newark Liberty Airport.

# Q33. Overall Share in Mosiac plot 
The share of flights among airports can be presented more easily in the output below:
```{r}
xtabs(data=budget_flights, 
formula=~ factor(origin) + 
factor(carrier))
mosaic(formula= factor(origin)~ factor(carrier),
data=budget_flights, gp = shading_hcl, gp_args = list(interpolate = c(1, 1.8)))
```

**ANALYSIS**

+ JetBlue has a larger share of its flights in JFK.
+ Delta has most of its flights in JFK and LGA. (Roughly equal distribution)

+ Summaries among delays

The following strip plot shows a comparison output of the three airlines on their performance of depature delay time:
```{r}
ggplot(data=budget_flights, 
aes(x=dep_delay, 
y= factor(carrier_name))) + 
geom_point( aes(color= factor(carrier_name)), 
size=1, 
position= position_jitter(height=0.4))+
ggtitle ("Relationship between carrier and departure delay") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme_bw()+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```


We have to spend a lot of Exploratory work on finding out there are delays in arrival, departure not only in one season but every season throughout the year. We tried to correlate it with various factors but without analyzing with weather datasets our reports will be incomplete so let's see the effects our delays with the weather datasets.

# Q34. Relationship between Weather and Departure delays.

```{r}
weather_n_flights <- flights %>%
mutate(dep_delay_by_hr = dep_delay/60) %>% # Convert it into Hour as all our datas are in minute
select(origin, year, month, day, hour, dep_delay_by_hr) %>% # Select the specfic columns
inner_join(weather, by = c("origin", "year", "month", "day", "hour"))
# glimpse(weather_n_flights) # Uncomment to see the weathe and flights datasets have been merged well.
```

After merging two datasets, let's Look into the visibility factor which is major of airlines to operate smoothly.

-  **Visibility:** Visibility is a measure of the distance at which an object or light can be clearly discerned. Visibility may vary according to the direction and angle of view, and the height of the observer. Visibility is affected by the presence of fog, cloud, haze, and precipitation.

# Q35. Trend in mean departure delay by visibility
```{r}
weather_n_flights %>% # Inner Join Weather with flights
select(dep_delay_by_hr, visib) %>% # Select only column of our interest i.e delay and visibility
filter(!is.na(dep_delay_by_hr) & !is.na(visib)) %>% # Filter out the missing datas
ggplot(aes(x = visib, y = dep_delay_by_hr)) + # Plot the graph
geom_smooth() +
theme_bw(base_size = 16) +
xlab("Visibility (miles)") + # X label 
ylab("Average departure delay (hours)") + # Y- label
ggtitle("Trend in mean departure delay by visibility") + # Title
theme(plot.title=element_text(size=12))+ # Size and theme
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))

```
**ANALYSIS**

Aircraft departure and arrival is limited by the visibility (or RVR) to an extent that depends on the sophistication of ground equipment, the technical equipment fitted to the aircraft and the qualification of the flight crew. Many aerodromes and aircraft are fitted with equipment that makes possible a landing in very low visibility conditions provided the flight crew is suitably qualified; however, in very low visibility, it may prove impossible for the pilot to navigate the aircraft along the runway and taxiways to the aircraft stand.

# Q36. Relationship between Pressure and Departure delays
```{r}
flights %>%
select(origin, dest, year, month, day, hour, dep_delay, arr_delay) %>%
inner_join(weather, by = c("origin", "year", "month", "day", "hour")) %>%
select(dep_delay, pressure) %>%
filter(!is.na(dep_delay) & !is.na(pressure)) %>% 
ggplot(aes(x = pressure, y = dep_delay)) +
geom_smooth() +
theme_bw(base_size = 10) +
xlab("Sea-level Pressure at departure hour (millibars)") +
ylab("Average departure delay (minutes)") +
ggtitle("Impact of Sea-level Pressure on Departure Delays")+
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
Let's pick one of the destinations in mid to long-haul flights to see the effects of Weather because on the short flight it will be hard to correlate the true findings. So just for a sake of the impact we can choose San Francisco as a final destination and see the variability in the speed.

# Q37. Speeds by carrier 
**Take an example of flights from east coast NYC to San-diego.**
```{r}
flights %>%
filter(dest == 'SAN') %>%
left_join(planes, by = "tailnum") %>%
left_join(airlines, by = "carrier") %>%
mutate(milesperminute = distance / air_time,
milesperhour = milesperminute * 60) %>%
ggplot(aes(x = carrier, y = milesperhour, fill = carrier)) +
geom_boxplot() +
guides(fill=FALSE) +
ggtitle("New York-San Diego: Speeds by Carrier") +
ylab("Miles Per Hour") +
coord_flip()+
scale_x_discrete(breaks=c("AA", "B6", "DL", "UA"),
labels=c("American Airlines", "JetBlue Airways", # two are our budget airlines & two i choose as a control so that we are not bias in our datasets out of 16.
"Delta Air Lines", "United Airlines"))+
theme(plot.title=element_text(size=12))+ # Size and theme
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
# Q38. Delays in flights to Midwest St. Louis by time of day 

Just not to be bias I will choose one more flight somewhere in midwest to see the effects.
```{r}
# Also we choose different airliness as we have choosen for the west coast airliness.
flights %>%
filter (dest == "STL") %>%
left_join(airlines) %>%
mutate(dep_delay_hours = (dep_delay/60)) %>%
filter(dep_delay_hours < 10 & carrier %in% c("AA", "EV", "WN", "MQ")) %>%
ggplot(aes(x = hour, y = dep_delay_hours, color = name))+
facet_wrap( ~ name) +
geom_point () +
xlab ("Hour of the Day") +
ylab ("Departure Delay (Hours)") +
geom_line(stat = "smooth", method = "loess" , aes(group = name, color = name)) +
theme_bw() +
scale_color_manual(name = "Airline",
values = c("American Airlines Inc." = "royalblue4",
"DeltaAir Lines Inc." = "blue4",
"Envoy Air" = "springgreen4",
"ExpressJet Airlines Inc." = "yellow",
"Southwest Airlines Co." = "orange",
"United Air Lines Inc." = "skyblue")) +
guides(color=FALSE) +
ggtitle("Delays in flights to Midwest St. Louis by time of day")+
theme(plot.title=element_text(size=12))+ # Size and theme
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

Drilling down to NYC airport for United Airliness.

# Q39. United's delays by NYC airport.

```{r}
flights %>%
rename(destination = dest,
departure_delay = dep_delay,
arrival_delay = arr_delay,
time_in_air = air_time) %>%
select(-year, -dep_time, -arr_time, -tailnum,
-flight, -hour, -minute, -day) %>%
mutate(ind_delayed_dep = ifelse(departure_delay > 0, 1, 0),
ind_delayed_arr = ifelse(arrival_delay > 0, 1, 0)) %>%
left_join(airlines, by = "carrier") %>%
group_by(origin, name) %>%
filter(carrier == "UA") %>%
summarise(n_obs = n(),
per_delayed_dep = round(sum(ind_delayed_dep, na.rm=TRUE) / n(),2),
per_delayed_arr = round(sum(ind_delayed_arr, na.rm=TRUE) / n(),2)) %>%
rename(Airport = origin,
`Carrier Name` = name,
`Number of Flights` = n_obs,
`Proportion with Departure Delays` = per_delayed_dep,
`Proportion with Arrival Delays` = per_delayed_arr) %>%
pander(style = "rmarkdown", split.tables = 200)
```
# Q40. Departure delays by month 

```{r}
months_Str <- c("JAN","FEB","MAR","APR","MAY","JUN",
"JUL","AUG","SEP","OCT","NOV","DEC")

flights %>%
filter(!is.na(dep_delay) & !is.na(month)) %>%
group_by(month) %>%
summarise(mean_dep_delay = mean(dep_delay)) %>%
# make month categorical by wrapping factor() around it and telling it the underlying labels
ggplot(aes(x = factor(month, labels = months_Str),
y = mean_dep_delay)) +
# rainbow colors on the bars, but not related to the values so not inside an aes(). color = "black" does the outline
geom_bar(stat = "identity", fill = rainbow(12), color = "black") +
xlab("Month") +
ylab("Time (minutes)") +
ggtitle("Average delayed departure time by month")+
theme(plot.title=element_text(size=12))+ # Size and theme
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

# Q41. How many seats are on a plane?

```{r}
data_manufacturer <- flights %>%
select(carrier, tailnum) %>%
left_join(airlines, by = "carrier") %>%
inner_join(planes, by = "tailnum") %>%
# let's group Airbus and Airbus Industries into one category
mutate(makers = ifelse((manufacturer == "AIRBUS" | manufacturer == "AIRBUS INDUSTRIE"), "AIRBUS", as.character(manufacturer))) 

# set up a vector of the top 3 within a list
list <- c("AIRBUS","BOEING","EMBRAER")

# how has the number of seats per plane changed over time?  
ggplot(data = data_manufacturer %>%
# filter to just the top 3 using the "in" function 
filter(makers %in% list) %>% 
select(makers, year, seats) %>%
# just need one row per maker-year-seat
# (many duplicates on the data!)
distinct(makers, year, seats),
aes(x = year, y=seats, color = makers)) +
geom_point() +
theme_light() + xlab("years") + ylab("number of seats") +
ggtitle("How has number of seats per plane changed over time?")+
theme(plot.title=element_text(size=12))+ # Size and theme
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

# Q42. Ovearll Stastical delays by month

```{r}
by_month <- group_by(nycflights,month)
dep_delay_month <- summarise(by_month, Mean = round(mean(dep_delay),digits = 2),
Median = round(median(dep_delay),digits = 2),
IQR = IQR(dep_delay),
MAX = max(dep_delay)
)
arrange(dep_delay_month,desc(Mean))
```
By knowing all the statistical numbers like the mean or the median a more reliable measure for deciding which month(s) to avoid flying if you really dislike delayed flights.

# Q43. On time departure rate for NYC airports

```{r}
nycflights_on_time <- nycflights %>%
mutate(dep_type = ifelse(dep_delay < 5, "on time", "delayed"))

nycflights_on_time  %>%
group_by(origin) %>%
summarise(ot_dep_rate = sum(dep_type == "on time") / n()) %>%
arrange(desc(ot_dep_rate))
```

If you were selecting an airport simply based on on time departure percentage, LGA airport would be best tof fly out.

```{r}
# nycflights_on_time <- nycflights_on_time %>% 
#         mutate(ontime = dep_delay < 5)
# 
# nycflights_on_time %>% 
#   group_by(origin) %>% 
#   summarise(ontime_prop = sum(ontime == TRUE) / n()) %>%
#   arrange(desc(ontime_prop))
```

# Q44. Overall Delayed and Ontime flights 

```{r}
ggplot(data = nycflights_on_time, aes(x = origin, fill = dep_type)) +
geom_bar()+
ggtitle("Overall Delayed and Ontime flights ") + # Title
theme(plot.title=element_text(size=12))+ # Size and theme
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

#Q45. Average Speed of the Airplanes 

```{r}
nycflights <- nycflights %>% mutate(avg_speed = distance / (arr_time/60))
ggplot(data = nycflights, aes(distance,avg_speed)) + geom_point()+
ggtitle("Average Speed of the Airliness ") + # Title
theme(plot.title=element_text(size=12))+ # Size and theme
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

The reason could be that with longer distances the start and landing time does not count so heavy as with short distances. There is one exception fast flight from LaGuardia to Atlanta. The very far flight distances (the points on the 5.000 miles distance rage) are FROM NYC to Honolulu (HNL), the shortest to Philadelphia (PHL).

```{r}
dl_aa_ua <- nycflights %>%
filter(carrier == "AA" | carrier == "DL" | carrier == "UA")

ggplot(dl_aa_ua, aes(x = dep_delay, y = arr_delay, color = carrier)) +
xlim(-25, 100) +
geom_point()+
ggtitle("Relationship between Arrival and departure delays ") + # Title
theme(plot.title=element_text(size=12))+ # Size and theme
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

# Q46 How many planes were late than 5 Minutes.

```{r}
nycflights <- nycflights %>% 
mutate(ontime = dep_delay < 5)
nycflights <- nycflights %>%
mutate(arr_type = ifelse(dep_delay < 5, "on time", "delayed"))

nycflights %>% group_by(origin) %>% summarise(ontime_prop_1 = sum(arr_type == 'delayed') / n()) %>% 
arrange(desc(ontime_prop_1))
```

# Q47. Analysing on Single Plane 

```{r}
singleplane <- filter(flights, tailnum=="N355NB") %>% 
select(year, month, day, dest, origin, distance) 
head(singleplane)
sum(singleplane$distance)
dim(singleplane)
```

# Q48. Looking other components of Weather on flight Datasets.

```{r}
head(weather)
avgdelay <- flights %>%
group_by(month, day) %>%
filter(month < 13) %>%
summarise(avgdelay = mean(arr_delay, na.rm=TRUE)) 
precip <- weather %>%
group_by(month, day) %>%
filter(month < 13) %>%
summarise(totprecip = sum(precip), maxwind = max(wind_speed))
precip <- mutate(precip, anyprecip = ifelse(totprecip==0, "No", "Yes"))
merged <- left_join(avgdelay, precip, by=c("day", "month"))
head(merged)
```

# Take Home Message:

One thing to consider living in east coast during winter month is that Snowstorms are the most frequent instigators of massive flight delays and cancelations at the metro's big three airports, but aren't the only weather nuisance. Situated on Flushing Bay, storm surge from flood LaGuardia's runways, which can push as far as the terminal buildings and jetways. Fortunately, many planes can be moved ahead of time if the weather is known beforehand to other airpor---
title: "NYC_Project The Flights Dataset"
author: "Pankaj Shah"
date: "`r format(Sys.Date(), '%B %d, %Y')`"
output:
revealjs::revealjs_presentation:
incremental: true
self_contained: false
reveal_options:
slideNumber: true
previewLinks: true
fig_width: 7
fig_height: 6
fig_caption: true
pdf_document:
fig_caption: yes
highlight: haddock
keep_tex: yes
pandoc_args: --listings
toc: yes
df_print: paged
xaringan::moon_reader:
yolo: true
nature:
autoplay: 30000
header-includes:
template: ' theme / report-template.tex '
html_document:
toc: yes
geometry: left = 0.5cm, right = 1cm, top = 1cm, bottom = 1cm
---

# Group 2 Project:
Instructor: LESSIA SHAJENKO

ALY 6040- 71233 DATA MINING APPLICATIONS
FALL 2018 CPS
PROPOSAL DRAFT
TEAM: FLIGHT ANALYST:

Northeastern University



# Main Outcome of this notebook:

By following the steps and running this notebook in your laptop, you will be able to understand and explore flights that were departed from the three major New York City airport in 2013. We will also generate and do graphical and statistical analysis along the ways to address why were their delays in the flight. If you follow the code and knit this file in pdf you will be able to learn the indispensable skills of data processing and subsetting. So happy Learning and exploring in the built datasets.


# Introduction:

In our lifetime we likely have all flown on airplanes once or many times. Or we might have known someone who has flown the plane, not a pilot but a traveler. One thing we hear from most of the travelers is about the planes getting delayed or canceled because of many factors besides weather and mechanical conditions. We also have witnessed many times in news the plane making Emergency Landing because of Failed Mechanical Components. We have also encountered frequently that some flights are delayed because of a variety of conditions from certain airports. As a data anlayst, we always try to understand if there are any ways we could avoid having to deal with these flight delays. If we have data available could we make sense of all these delays or a certain time of year we should avoid trying to fly? Throughout this project, I am going to analyze data related to flights which are contained in the nycflights13 package (Wickham 2018). It is easy to download in R studio and not hard to find. Specifically, when we download into R workspace from the library this package contains five datasets saved as “data frames”. The nycflighsts datasets contain the information mostly about all domestic flights departing from Big Apple(New York City) in the year 2013. From the datasets, we can get the information about the airports. 


There are three airports.

- **Newark Liberty International (EWR)** <br>
- **John F. Kennedy International (JFK)** <br>
- **LaGuardia (LGA) Airports** <br>

The **flights** data frame is the main dataset in the package not only contains detailed information for all the flights that had departed from NYC in the year 2013 but also information about **airlines**,**airports** and **weather**.  It is pretty good datasets to analyze and understand a little bit about the Aviation industry and datasets is real world example itself from New York.


New York City ranks just above the middle of the pack for both average snowfall (23 inches per snow season) and days with measurable snow in a year (14 days). Despite that, snowstorms can cripple air travel for a full day or longer at this airport, as well as the major airports nearby. Snowstorms aren’t the only factors that trigger delays. Frontal systems can also cause delays when they’re accompanied by low clouds.Of the New York area’s three major airports, JFK saw the fewest arrivals in the time period we studied, but there were more than enough delays to vault this hub into our top 10.

**Information about the nycflights package:** 

The package was created on June 22th, 2014, by Hadley Wickam.(Remember that name). Every data Analyst or Data Scientist who works in R knows him. For more details regarding the package, please refer to the [nycflights13 introduction page](http://cran.r-project.org/web/packages/nycflights13/nycflights13.pdf). 

**Goals and Outcomes of this project:**

We will together explore the data sets in the 'nycflights13' package to find out about the flight delays, cancellation, trends, insights and uncover interesting anomalies regarding traffic volume across airline carriers as well as the three different airports. The datasets are easier to understand and a lot of things can be done using the datasets. So I am excited about the project. Let's dive deeper and explore the unseen journey of nycflights13.

# Datasets Description <br>
**Info about Datasets** 

- flights: information on all `dim` dimension flights.
- airlines: translation between two letter IATA carrier codes and names (16 in total)
- planes: construction information about each of 3,322 planes used.
- weather: hourly meteorological data (about 8705 observations) for each of the three NYC airports
- airports: airport names and locations.

Sourceof the original data: RITA, Bureau of transportation statistics

• http://www.transtats.bts.gov/DL_SelectFields.asp?Table_ID=236

**Lets first start to check all the packages that we need to run and analyse this whole workbook.** <br>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, size="small", tidy.opts=list(width.cutoff=60),tidy= FALSE, global.par = TRUE)
# display code as typed
# slightly smaller font for code
```

```{r}
webshot::install_phantomjs() #this following code helps to convert it in pdf document nicely
```

These is the session info of these R codes. Check for the specific package and the library version if you run  into any of the issues.
```{r}
sessionInfo()
```

Check for the specific packages in your specific Laptop. 
```{r}
if(!require(dplyr)) install.packages("dplyr")
if(!require(ggplot2)) install.packages("ggplot2")
if(!require(nycflights13)) install.packages("nycflights13")
if(!require(grid)) install.packages("grid")
if(!require(vcd)) install.packages("vcd")
if(!require(readr)) install.packages("readr")
if(!require(moderndive)) install.packages("moderndive")
if(!require(kableExtra)) install.packages("kableExtra")
if(!require(lubridate)) install.packages("lubridate")
today <- Sys.Date()
today
```

# Library 
Load helpful necessay packages. 
```{r, load_libraries, warning=FALSE, message=FALSE}
library(ggplot2)
library(dplyr)
library(nycflights13) # Our datasets is coming from these library
library(pander)
library(grid)
library(vcd)
library(readr)
library(moderndive)
library(kableExtra)
library(statsr)
library(lubridate)
library(geometry)
library(rticles)
library(revealjs)
```
**Dimensions** <br>

The following code will display the dimension of our datasets as it is very important to know how big your data is even before we dive in. Each observation (row) that we see below in the **flights** data frame represents a separate flight originated from one of the three airports from the New York City in the year 2013.

**Structure of Flights datasets** 
```{r}
str(flights)
```
# Data Dictionary <br>
From the above outputs. Let's understand the column names which will help us to diagnose the data much easier.<br>
The *column names*  and *column descriptions* are given below: 

**First Three column names** 

- **year, month, day**  -  Date of departure (DATETIME)<br>
- **dep_time** -  Departure time, in minutes *in local time zone* <br>
- **sched_dep_time** - Scheduled Departure time, in minutes *in local time zone* <br>
- **dep_delay** - Departure delays, in minutes *Negative times represent early   departures/arrivals* <br>
- **arr_time** - Arrival Time, in minutes *These are in local time zone* <br>
- **sched_arr_time** - Scheduled Arrival, in minutes time *in local time zone* <br>
- **arr_delay**  - Arrival delays, in minutes. *Negative times represent early arrivals* <br>
- **hour, minute**  -  Time of departure broken in to hour and minutes <br>
- **carrier**  -  Two letter carrier abbreviation. **For more detail refer to airlines datasets to get the names**  <br>
- **tailnum** -  Plane tail number (Every plane has its unique TailNum) *Think as a Licensce Plate Number of each vehicle* <br>
- **flight**   -  Flight number (Unique Number for each flight) <br>
- **origin**   -  Origin (One Aiprot out of Three) . See  **airports**  data set for additional metadata <br>
- **dest** - Final Destination <br>
- **air_time** -  Amount of time Plane has spent in the air. Starting from origin to reach the final Destination. <br>
- **distance**  -  Distance travelled  <br>

An example of the observations is shown as follows: <br>
Lets look at first observation of the data.First observation that has been recorded in our datasets. <br>

# Information about the datasets.
```{r}
df_info <- function(x) {
data  <- as.character(substitute(x))  ##data frame name
size <- format(object.size(x), units="Mb")  ##size of data frame in Mb

##column information
column.info <- data.frame( column        = names(sapply(x, class)),
#class         = sapply(x, class),
unique.values = sapply(x, function(y) length(unique(y))),
missing.count = colSums(is.na(x)),
missing.pct   = round(colSums(is.na(x)) / nrow(x) * 100, 2))

row.names(column.info) <- 1:nrow(column.info)

list(data.frame     = data.frame(name=data, size=size),
dimensions     = data.frame(rows=nrow(x), columns=ncol(x)),
column.details = column.info)
}
Sys.timezone() # Will Display Time zone of your zone
```
# Information about the Airlines
```{r}
df_info(airlines)
```
# Information about the Weather
```{r}
df_info(weather)
```
# Information about the Airports
```{r}
df_info(airports)
```
# Information about the flights
```{r}
df_info(flights)
```
# Head of Flights datasets
```{r}
head(flights, 1) %>% table()
```
**Interpretation:** 

- year : 2013<br>
- month : 1 (JAN)<br>
- day : 1st
- dep_time : 5:17 AM( EST)
- sched_dep_time : 5:15 AM (EST)
- dep_delay : -2 (Negative 2 Min i.e 5:15AM - 5:17 AM) Departed early before Scheduled.
- arr_time : 8:30 AM
- scheduled_air_time : 8:19 AM
- arr_delay : 11 Minutes (8:19- 8:30 AM)
- carrier : UA
- flight : 1545
- tailNum : 14228
- Origin : EWR(Newark Liberty International)
- dest : IAH
- air_time : 227 Minutes i.e 2 HR 27 Minutes. (8:30 - 5:17)
- distance: 1400 Miles
- HR & Min: 5 Hr 15 Minutes.

**WORD ANALYSIS**

- For Example The flight # 1545 is The United Airlines flight (tail NUM: 14228) which originated from Newark Liberty International(EWR) airport in New York, NY flew to George Bush Intercontinental Airport (IAH) in Houston Texas on January 1, 2013 departing at 5:17 am (EST) and arriving at 8:30 AM (CST). It flew a distance of 1400 miles for 2 hours and 27 minutes, spending in the air minutes and leaving EWR airport earlier than the scheduled time by 2 minutes. Arrived at Houston Airport 11 Minutes in delay than scheduled flight.

# Flights Dataset preparation:


# Q1.TOP 10 carriers from all three airports. <br>
```{r}
flights_table <- flights %>% 
group_by(carrier) %>%
summarise(number = n()) %>% 
arrange(desc(number)) %>% top_n(10)

flights_table$carrier <- as.factor(flights_table$carrier)
flights_table$number <- as.numeric(flights_table$number)
flights_table
```
**ANALYSIS**

We see that UA flew most from all three airports [58665]. Below we will plot in descending order.<br>
```{r}
ggplot(flights_table, aes(x=reorder(carrier,-number), y=number)) +
geom_bar(stat="identity") + 
labs(x="Carrier", y="Number of Flights")+
ggtitle("Top 10 Carriers from three airports.") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") + 
theme(
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#1E1E20",face="bold.italic" ),
plot.title = element_text(color="#D70026", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
**ANALYSIS**

From the above barplot, we can conclude that United Airways(UA) has done more flights from all three airports combined. Followed by Jet Blue (B6) & (EV).

# Basic Data Exploratory
Lets do some basic data Exploratory Analysis before we dive into detail.
```{r}
basic_eda <- function(data)
{
library(Hmisc)
library(funModeling)
library(tidyverse)

#profiling_num(data) 
#plot_num(data)
#describe(data)
#df_status(data)
#glimpse(data)
freq(data)
sapply(data, function(x) sum(is.na(x)))
}
```

```{r message = FALSE, warning= FALSE}
options(max.print = 100)
basic_eda(flights)
```
# Q2. Descrptive Analysis of Flights Datasets.
**Lets breakdown the individual elements**
```{r}
# Describe the flights data by each columns to get Insights
describe(flights)
```

**Visual Representation of Datasets**
```{r warning= FALSE}
# Attributes which are not identical across measure variables will be dropped.Also all biwidht must be positive.
plot_num(flights)
```
Lets check the status of our datasets. Let us provide indepth knowledge of missing datasets.

# DF status of Flights
```{r}
df_status(flights) # Its good for analysing Missing datasets and to spot unique numbers.
```
As we have seen that we have missing datasets in the number of columns. We need to address those variables before we diagnose our flights' datasets.

# Handling the Missing datasets
```{r}
print(" The number of missing values in Flights datasets is ")
sapply(flights, function(x) sum(is.na(x)))

print("The number of missing values in Airlines datasets is")
sapply(airlines, function(x) sum(is.na(x)))

print(" The number of missing values in Airports datasets is ")
sapply(airports, function(x) sum(is.na(x)))

print(" The number of missing values in Weather datasets is ")
sapply(weather, function(x) sum(is.na(x)))
```
**MISSING DATA ANALYSIS**

- In Flights datasets we have 
+ dep_time : 8255 Missing data
+ dep_delay : 8255 Missing data
+ arr_time : 8713 Missing data
+ arr_delay : 9430 Missing data
+ tailnum : 2512 Missing data
+ air_time : 9430 Missing data

- We don't have any Missing data in Airlines datasets.

- We don't have any Missing data in Airports datasets.

- In Weather datasets we have:

+ temp : 1 Missing data
+ dewp : 1 Missing data
+ humid : 1 Missing data
+ wind_dir : 460 Missing data
+ wind_speed : 4 Missing data
+ wind_gust : 20778 Missing data
+ pressure : 2729 Missing data<br>

Just for simplicity purpose (quick and dirty analysis), We will omit all the missing datasets to get the gist of Exploratory Data Analysis but while building upon the model or making a coorelation assumption as well as doing more detail linear Regression we will take care of these missing data in detail effort. For now let's drop the missing datasets.

```{r}
flt_1 <- flights %>% na.omit()
# Sanity check
sum(is.na(flt_1))
# Detail Sanity check
sapply(flt_1, function(x) sum(is.na(x)))
```
We can Confirm that the "flt_1" datasets we just created from flights datasets don't have any missing datasets in it. we have dropped rows from the original datasets. Sanity check was run through.

After Handling the missing data we can work with the datasets. So lets dive have a glimpse of our datasets and fix its class so that we can easily explore datasets without any hickups.
```{r}
glimpse(flt_1)
```
# Type Conversion
```{r}
#convert the types of existing variables from character to factor and store back to its datasets.
flt_1$carrier<-factor(flt_1$carrier)
flt_1$tailnum<-factor(flt_1$tailnum)
flt_1$origin<-factor(flt_1$origin)
flt_1$dest<-factor(flt_1$dest)
```
# Join 

**Flights datasets with Airliness, Airports**

Let's create one dataset with all the necessary information. We have a dataset with carrier name but we are missing its full acronym, which can be founded in airlines datasets. Below in these codes, we will join flt_1 with airlines' datasets.

```{r message = FALSE, echo= FALSE, warning= FALSE}
# Join flt1 with airlines datasets
flt_1 <- left_join(flt_1, airlines, by = NULL, copy = false) # The reason for doing by = NULL as we don't have any common columns but the elements inside can be replicated. We are recoding with the acronym.
colnames(flt_1) # Sanity check that name has been imported to our flt_1 datasets.
flt_1 <- rename(flt_1, "carrier_name"= "name") # Renaming the column name "name" to "carrier_name". "name" is coming from the airliness datasets.
# colnames(flt_1) # Uncomment to see the name has been changed.
```

After we have successfully joined flights datasets with the Airlines's datasets. We can similarly do with Airports datasets. Let's look at the column name of airport datasets. Here We have faa code given to each airport which can be matched with airports origin and destination. 

```{r}
colnames(airports)
# unique(airports$faa) #  Uncomment it see all the unique airports faa code.
```

```{r warning= FALSE}
# Left join faa code with destination.
flt_1 <- left_join(flt_1, airports , by = c("dest" = "faa"), copy = false)
#colnames(flt_1) # Uncomment to do sanity check.
flt_1 <- rename(flt_1, "arrival_airport"= "name") # change name which is coming from airports to arrival_airport.

# Left join faa code with origin.
flt_1 <- left_join(flt_1, airports , by = c("origin" = "faa"), copy = false)
#colnames(flt_1) # Uncomment to do sanity check.
flt_1 <- rename(flt_1, "departure_airport"= "name") # change name which is coming from airports to arrival_airport.

#colnames(flt_1) # Uncomment to do sanity check.
glimpse(flt_1) # Lets have a look to our datasets, confirm everything has been imported as we wish for. 
```
# Factor Conversion

For calculations purpose, we will convert the following variables to factor. i.e. carrier_name, departure_airport, origin, arrival_airport so that we can do basic calculations.

```{r}
flt_1$carrier_name<-factor(flt_1$carrier_name)
flt_1$departure_airport<-factor(flt_1$departure_airport)
flt_1$origin<-factor(flt_1$origin)
flt_1$arrival_airport<-factor(flt_1$arrival_airport)
flt_1$month <- factor(flt_1$month)
```
Flight delays due to weather are an unfortunate reality, especially at some of the busiest airport hubs in the United States.After we have done all these type conversions and fixing our datasets without any missing data. Our datasets are ready to get explored. So without any delays, let's jump into Exploratory Data Analysis. First Lets break down the casual delay by Season. We would like to know if the delays are common in all season or it is only in one season. We have month datasets so we will convert month into the season according to a standard Calendar month and see if there are any Seasonal delays.

# Q3. Departure delay by Season 
```{r}
#create seasons
flt_1<- flt_1 %>% mutate(Season = ifelse(month %in% c(6,7,8), "Summer",
ifelse(month %in% c(9,10,11), "Fall",
ifelse(month %in% c(12,1,2), "Winter",
"Spring"))))
table(flt_1$Season)
# Boxplot 
boxplot(formula = dep_delay ~ Season,
data = flt_1,
main = 'Departure delay by Season',
xlab = 'Season',
ylab = 'Departure delay [min]',
border = c('springgreen', 'indianred1', 'orange', 'skyblue'),
names = c('Spring', 'Summer', 'Fall', 'Winter') +
theme_dark()+
theme(
plot.title = element_text(color="red", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold")))

aggregated_mean_sd_median <- cbind(
mean = aggregate(formula = dep_delay ~ Season,
data = flt_1,
FUN = mean, 
na.rm = T),
sd = aggregate(formula = dep_delay ~ Season,
data = flt_1,
FUN = sd, 
na.rm = T),
median= aggregate(formula = dep_delay ~ Season,
data = flt_1,
FUN = median, 
na.rm = T)
)
aggregated_mean_sd_median 
```

```{r}
# ALT WAY of plotting same graph with geom_boxplot
ggplot(flt_1, aes(x = Season, y = dep_delay)) +
geom_boxplot(color = c('springgreen', 'indianred1', 'orange', 'skyblue'), fill = c('springgreen', 'indianred1', 'orange', 'skyblue')) +
scale_y_continuous(name = "Departure Delay [Min]",
breaks = seq(0, 1400, 200),
limits=c(0, 1400)) +
scale_x_discrete(name = "Season") +
ggtitle("Departure delay by Season") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"),
plot.title = element_text(size = 20, hjust = 0.5, color = "red", face="bold.italic"),
text=element_text(size = 16),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#1E1E20", face="bold.italic"),
axis.text.x=element_text(colour=c('springgreen', 'indianred1', 'orange', 'skyblue'), size = 12),
axis.text.y=element_text(colour="black", size = 12))
```
**ANALYSIS**

As we can see from above boxplot that Delays are consistent across the season. During the Winter month, we can see there are some flights which are delayed longer compare to summer, fall and spring. During the Spring the delays are a lot smaller. But overall it's not Seasonal, there are various factors that cause delays besides the weather in winter months. One of the interesting observation we could take from the above graph is why there are delays in the Summer month. When the East Coast Weather is so perfect, no snow storm and weather is getting better. Why are there delays? Let's break down our Seasonality effect to month so that we can see if there is any particular month that has more delays than others.

# Q4. Departure Delay across Month in all three airports.
```{r}
ggplot(flt_1, aes(x = month, y = dep_delay) ) + 
geom_point(alpha = 0.3, color = 'steelblue') +
labs(x="Dep_delay", y="Months", 
caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
ggtitle("Departure Delay across Month") +
theme(
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#1E1E20",face="bold.italic" ),
plot.title = element_text(color="#D70026", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))+
coord_flip()
```
**ANALYSIS**

Departure delay is equally distributed among all the months. In these plot its really hard to see a huge difference between the months. We can see in some months there are huge delays because of the presence of many outliers but in some months there are less. In the month of January, we can see some outliers are data are fairly spread out. It seems like month June(6th) July (7th) is more densely blue than rest of month. Let's plot another plot where we can see these difference much clear way.

```{r}
t_subset_flight <- subset(flt_1, !is.na(dep_delay), !is.na(arr_delay)) 
ggplot(aes(x = dep_delay), data = subset(t_subset_flight, dep_delay >= 0 & dep_delay <= quantile(dep_delay, .90) ) ) +
geom_histogram(aes(fill = carrier), binwidth = 1) + 
facet_wrap(~month)+ # break down by carrier.
ggtitle("Departure Delay across Month") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#1E1E20",face="bold.italic" ),
plot.title = element_text(color="#D70026", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))

```
# Q5.Departure Delay across months Statistical Analysis

```{r}
flt_1 %>%
group_by(month) %>%
summarise(mean_dd = mean(dep_delay)) %>%
arrange(desc(mean_dd))
```
# Q6. Which month has the highest average departure delay from an NYC airport?
- July
- June
- December

July, followed by June is the month with the highest average delay of flights departing from an NYC airport. A high average mean of delay has also observed in December, suggesting that the problem lies in the number of flights during the Holidays. The months with the lowest average of departure delays are September to November.

# Q7. Departure Delay Across Month and days.
```{r}
subset_flight <- subset(flt_1, !is.na(dep_delay), !is.na(arr_delay)) 
ggplot(aes(x = day, y = dep_delay), data = subset_flight ) +
geom_point(alpha = 0.04, color = 'brown') + 
ggtitle("Departure delay across  all month and days between all Airlines.") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
plot.title = element_text(color="red", size=14, face="bold.italic", hjust = 0.5),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#1E1E20", face="bold.italic"),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))+
facet_wrap(~month)
```
# Q8. Departure Delay across Carrier

Lets also breakdown the analysis by carrier so that we can see if these is across all airlines.
```{r}
ggplot(aes(x = dep_delay), data = subset(subset_flight, dep_delay >= 0 & dep_delay <= quantile(dep_delay, .90) ) ) +
geom_histogram(aes(fill = month), binwidth = 1) + 
facet_wrap(~carrier)+ # break down by carrier.
ggtitle("Departure Delay across Carrier") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#1E1E20",face="bold.italic" ),
plot.title = element_text(color="#D70026", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))

```
**ANALYSIS** 

- Major contributor :
- AA : American Airliness.
- B6 : Jet Blue Airliness.
- DL : Delta Airliness.
- EV : Express Jet lines
- UA : United Airliness (Biggest Contributor) 

Seems reasonanble as it does more flights than others.

As it is clear from the above graph that we are seeing more delays in the month of June and July. We also can see which carrier is playing the major role in causing such delays. Below I will plot the Histogram plot to see the break down of those two months.

# Q9. Departure Delay in June & July

```{r}
# Histogram plot for June 
June <- subset(flt_1, month == 6)
June <- subset(June, !is.na(dep_delay), !is.na(arr_delay))

ggplot(aes(x = day, y = dep_delay), data = June ) +
geom_point(aes(color = carrier))+
ggtitle("Departure delay across month of June between all Airlines.") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
plot.title = element_text(color="red", size=14, face="bold.italic", hjust = 0.5),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#1E1E20", face="bold.italic"),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))

# Histogram plot for July
July <- subset(flt_1, month == 7)
July <- subset(July, !is.na(dep_delay), !is.na(arr_delay) )

ggplot(aes(x = day, y = dep_delay), data = July ) +
geom_point(aes(color = carrier))+
ggtitle("Departure delay across month of July between all Airlines.") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
plot.title = element_text(color="red", size=14, face="bold.italic", hjust = 0.5),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#1E1E20", face="bold.italic"),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
**ANALYSIS**


It is clear from both charts that delay was not specific in one day but across the month. Still, these datasets we have is not just enough to make any prediction or statements but after looking at the datasets we can surely say that between June and July there are huge delays.

# Q10. Relationship between arr_delay and dep_delay.

Lets see if there is any relationship between arr_delay and dep_delay in our datasets.
```{r}
ggplot(subset_flight,aes(x = dep_delay, y = arr_delay)) +
geom_point(aes(color = carrier), alpha = 0.6)+
geom_smooth(method= lm)+
ggtitle("Relationship between Arrival and Departure delays") +
theme(
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="green", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
**ANALYSIS**

From the above plot, we can see there is a linear relationship between arrival delay and departure delays among all the carriers and across all the airports.

After quick and dirty analysis we will tweak our model a little bit and see if the delays are not marginal. Till now if the arrival and departure of the airlines are not on schedule then we are simply calling it delays but if we normalize our datasets we can make our analysis much better. So to do that let's calculate mean and median of departure delays across all the carriers in one plot.

# Q11. Mean and Median departure delay across all the carriers

```{r}
# It will take atleast 5 minutes to run this code. [ BE PATIENCE !!! ]

ggplot(subset_flight,aes(x = carrier, y = dep_delay))+
geom_point(color = 'red', stat = 'summary', fun.y = mean) +  # MEAN
geom_point(color = 'blue', stat = 'summary', fun.y = median)+ # MEDIAN
geom_hline(aes(yintercept = mean(dep_delay, na.rm = TRUE)), color = 'red')+
geom_hline(aes(yintercept = median(dep_delay, na.rm = TRUE)), color = 'blue')+
ggtitle("Mean and Median departure delay across all the carriers") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
geom_text(aes (x = 1, y = 14), label = "MEAN", hjust = 0, color = 'red', fontface = "bold")+
geom_text(aes (x = 1, y = 0), label = "MEDIAN", hjust = 0, color = 'blue', fontface = "bold")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
**ANALYSIS**

After looking at the variance of the datasets we can see that there is quite a difference between Mean and Median across all the airlines. 

Lets calculate mean delay:
```{r}
mean(flt_1$dep_delay, na.rm = TRUE)
```
**What is our cut off point. What should be consider late  or early delays** <br>

We can pick based on average mean which cames out to be 12.55 as a baseline. As it is not standard anything beyond its scheduled arrival is delayed the flight. But in our datasets, we can wiggle a little bit to pick one cut offline and we can bin the flights into respective variables, I think this would be the way to do it. 

In Summary, we will Create a categorical variable for departure delay (dep_delay), which we consider to be departure status. Departure delay is a continuous variable capturing the difference in minutes between the expected and actual departure times. The new variable which we generated classifies the delay into 3 discrete levels: Early (up to 0 minutes of delay), On time (up to 13 minutes of delay), and Late (above 13 minutes of delay).


```{r}
flt_1$dep_status <- flt_1$dep_delay # slicing dep_delay to dep_status. I can do mutate.
flt_1$dep_status<- ifelse(flt_1$dep_status < 0,'Early', # Recoding 
ifelse(flt_1$dep_status < 13,'On Time','Late'))
flt_1$dep_status<-factor(flt_1$dep_status) # type conversion
table(flt_1$dep_status) # Better if we have prop table.
```
**ANALYSIS**

There were more early flights compare to Late and On- time flights. From the above table, we can say that must flights seems to be early if they have an early departure. We will dive into Late flights further down but we can see that when we change our baseline we see the huge improvement in Early and On-time departure delay airlines.

# Q12. Spotting the Outliers in Late Flights.

The graph below was generated to ensure that the new *categorical* variable matches the original *factor* variable:**Also we can visually spot some outliers in late arrival column which are more than 1000 Minutes** We will diagnose all those variables later to see the casual inferences. We can see that most of the late flights are dense between 0 to 500 Minutes and then it starts to disperse and then we see some heavy outliers around 1300 Minutes.

```{r}
ggplot(flt_1, aes(x=dep_delay, y=factor(dep_status))) +
geom_point(aes(color=factor(dep_status)))+
ggtitle("Departure Status of the dep_delays flights")+
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),  color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))

```

Let's look at one more perspective if flights are arriving in the airport on time. We can take mean to get the sense of the data.

```{r}
mean(flt_1$arr_delay, na.rm = TRUE)
```

Similarly, as we wiggle our baseline for departure delays we can do similarly for the arrival delays. We will create a categorical variable (arrival status) for arrival delay (arr_delay) with levels: Early, On time, and Late. In creating this variable, we followed the same approach as that used for the departure delay variable above.

```{r}
flt_1$arr_status <- flt_1$arr_delay
flt_1$arr_status<- ifelse(flt_1$arr_status < 0,'Early',
ifelse(flt_1$arr_status < 6.9,'On time','Late')) # taking Mean as On_time baseline.
flt_1$arr_status<-factor(flt_1$arr_status)
table(flt_1$arr_status) # prop.table to do analysis.
```
**ANALYSIS**<br>

The graph below was generated to ensure that the new *categorical*  variable matches the original *factor* variable as we did above for the arrival. Keeping it consistent. We can see a small fraction of planes arrive on time, there are more planes that arrive early.

```{r}
ggplot(data=flt_1, aes(x=arr_delay,
y=factor(arr_status))) +
geom_point(aes(color=factor(arr_status)))+
ggtitle("Arrival Status of arr_delay flights")+
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

# Q13. Variable Summaries

A statistical summary of all the variables within our dataset was generated below using the 'summary' command in R:
```{r}
summary(flt_1)
```
While the information above provides a high-level introduction to the data set, the sections below shall focus on specific analyses of the 'flights' data set. 

# Q14. Analysis by flight volume:

A high-level view of the flight volumes coming out of the NYC area is displayed below:
```{r}
print("Number of flights flown away from given three airports:")
sort(xtabs(formula = ~ departure_airport, data = flt_1), decreasing = TRUE)
```
**ANALYSIS**<br>

It seems like an almost equal number of flights flew away from all these three airports as there are small marginal changes between these three airports. As La Guardia airport seems to have fewer flights than other two maybe because of being domestic Airport compare to two other International Airports with international flights.

While the three airports manage similar volumes, Newark Liberty international airport is in the lead. We shall now drill down into the volume data, looking at flight traffic from different perspectives.

# Q15. Flight volume over time

The flight count by month is displayed below:

```{r}
ggplot(flights) + 
aes(x=factor(month)) +
geom_bar(aes(fill=factor(month))) +
scale_colour_brewer(palette = "Set1")+
theme_dark()+
ggtitle("Flight volume over time")+
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))+
coord_flip()
```
**ANALYSIS** 

What we observe is flights throughout the year remains consistent with a little dip in the month of February(2nd) which I believe because of Northeaster Weather. We will dig into that components later when we once merge our datasets with Weather data and see the number of cancellation in each month of the year and by airlines. Most of the flights are during the summer season where the cancellation due to weather seems less. But that is another can of worms which we will dig into it later on.

The output shows that the number of flights each month appears to be consistent and closely follows the number of days in each month. It indicates that the number of flights stays consistently within days. Our finding will be underscored by the output of counting a number of flights within days (ranging from 1 to 31) which is shown below:

```{r}
ggplot(flights) + 
aes(x=factor(day)) +
geom_bar(aes(fill=factor(day)))+
scale_colour_brewer(palette = "Set1")+
theme_dark()+
ggtitle("Flight volume over time breaking down by days")+
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))+
coord_flip()
```
**ANALYSIS** 

29th and 30th seem less flown date. 31st makes total sense as we can have 31st in calendar only half of time. Also, We don't have a dataset of our tickets so it will be a little hard to draw a conclusion just based on these bar plots. But in the ideological world, if there was an equal number of flights offered from all these three airports across the given days. People tend to fly less towards the end of the month but by not much. If we pay close attention we can see that from 23 it starts to dip but these could be totally due to the availability of flights and other unseen factors. 
# Q16.Flight volume by flight distance.

The following bar chart shows the number of flights grouped by flying distance, which helps indicate the type of flights departing from NYC( Short-distance domestic, Long-distance domestic, International).
```{r}

ggplot(flt_1, aes(x=distance)) +
geom_bar(aes(color=1)) + guides(color=FALSE)+
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
ggtitle("Flight volume by flight distance")+
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

As we can see most of the flights are from range 0 to 2800 Miles. There are some long-haul flights around 5000 Miles. We can bin the flights based on good model assumption as short, mid-distance and long-haul flight category. To do that let's take the summary of our flight datasets.

```{r}
summary(flt_1$distance, na.rm = TRUE)
# table(flt_1$distance) # Uncomment to see all the flights for specific distance.
```

```{r}
ggplot(flt_1, aes(x=distance)) +
geom_histogram(aes(color=1), binwidth = 500) + guides(color=FALSE) +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
ggtitle("Flight volume by flight distance ")+ # Using binwidth to split the flights into short,mid & long.
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
**ANALYSIS**

More flights were flown 2nd and 3rd bin. We also see some flights that were flown for more than 4000 Miles(Outliers). These most be international flights or long haul flights. The distance between East coast to West Coast is around 2500-3000 Miles. It must have been flights from New York to Hawaii which is around 5000 Miles.

We set 500 miles as the bin width for this report. The output shows that the highest proportion of flights have distances less than 1500 miles. It indicates that most of the flights are traveling short or mid-distance domestic routes. There's also a considerable number of flights with distances around 1500-2500 miles. It indicates the second most common group of flights is long-distance domestic flights / short distance international flights (The flight distance from NYC to Los Angeles is 2500 miles). Last but not least, there's a little number of flights fall into the range from 4500 to 5000 miles, which indicates that the long-distance international flights only count for a small proportion of the total flights departing from NYC.
Generating the same chart, while taking the different departure airports into account, results in the following output:
```{r}
ggplot(flt_1, aes(x=distance)) + 
geom_bar(aes(fill=factor(origin)), binwidth = 500) + 
guides(color=FALSE)+
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
ggtitle("Flight volume by flight distance segregated by Airports")+ 
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
**ANALYSIS** 

- EWR : RED
- JFK : GREEN
- LGA : BLUE

A higher proportion of short and mid-distance flights. A very small proportion of long distance but hard to visualize as they stack on top of one another. LGA is not international terminal.LaGuardia is the busiest airport in the United States without any non-stop service to Europe.  Laguardia doesn't have any International arrivals because the runways are shorts.

# Q17. Flight volume by carrier
Below is a table showing flight volume by departure airports and carrier airlines.
```{r}
xtabs(formula = ~ carrier_name + departure_airport, data = flt_1)
```
** Observations ** 
-  Airtran, Mesa ,Frontier only fly from LaGuardia.<br>
-  Alaska only flew from Newark Liberty Intl <br>
-  Hawaiian only flew from JFK. <br>
-  Skywest only flew 6 times through newark that is the lowest and 23 from LGA both are lowest. <br>
- United airways flew most 45,501 planes from Newark Liberty Intl<br>

- Frequencies of airports for each airline companies to depart from. 
- UA (United Airlines) is the biggest number of airlines in 2013. 
- Lots of flight departed from Newark Liberty International Airport (EWR).

**Also remember JFK and Newark are International terminal whereas LGA is domestic airport**
```{r}
colnames(flt_1)
```

# Q18. Flight volume by destination
The table below shows the top 10 destination airports for flights departing from the NYC area:
```{r}

flt_by_dest <- flt_1 %>% 
group_by(arrival_airport) %>%
summarise(dest_count = n()) %>% 
arrange(desc(dest_count)) %>% top_n(10)
flt_by_dest

ggplot(flt_by_dest, aes(x=reorder(arrival_airport,-dest_count), y=dest_count)) +
geom_bar(stat="identity", fill = rainbow(10)) + 
ggtitle ("Top 10 Destination by Flight Volume") +
theme(legend.position="top") +
theme_dark() +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))+
coord_flip()
```
**ANALYSIS**

+ ATL : Hartsfield Jackson Atlanta Intl : Hub connecting many other flights so it makes sense.
+ ORD : Chicago Ohare Intl : Hub connecting to Lots of Midwest and the West coast flights so make sense.
+ LAX : Los Angeles Intl :  West Coast direct flight so make a sense.
+ BOS : General Edward Lawrence Logan Intl
+ MCO : Orlando Intl : Tourism Spot
+ CLT : Charlotte Douglas Intl : Interesting why Charlotte. 
+ SFO : San Francisco Intl : West Coast flights same as people leaving for toursism. Direct flight is advantage.
+ FLL : Fort Lauderdale Hollywood Intl : Florida Tourism spot
+ MIA : Miami Intl : Tourism Spot
+ DCA : Ronald Reagan Washington Natl : Tourism as well as political ( Washigton DC)

**Largest number of flights are on domestic routes (Boston  being one of them, Chicago can be included but i might say it might be connecting hub to west coast as well as Midwest flights)**

# Q19. Flight volume by departure airport

+ Analysis by carrier

Below is a summary showing the relationship between departure airports and carrier airlines.
```{r}
xtabs(formula =~ carrier_name + origin, data = flt_1)
ggplot(flt_1,  
aes(x=factor(carrier))) + 
geom_bar(aes(fill= factor(departure_airport)))+
ggtitle ("Flight volume by departure airport") +
theme(legend.position="top") +
theme_dark() +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
**ANALYSIS**

It coorelates to our findings as well where the flight volume by flight destination that we observed above.
-  Newark is Hub for UA as well as EV.
-  HA only flew to JFK.
-  F9, FL only to La Guardia.

**UA has departed the biggest number of airlines in 2013. And major flights departed from EWR**

# Q20. Summary showing the flight volumes by departure airports across months:
```{r}
xtabs(formula = ~ month + departure_airport, data = flt_1)
ggplot(flt_1) + 
aes(x=factor(month))+ 
geom_bar(aes(fill= factor(departure_airport)))+
ggtitle ("Flight volumes by departure airports across months") +
theme(legend.position="top") +
theme_dark() +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
**ANALYSIS**

The output indicates that the flight volumes among different airports by month generally remain consistent, however, La Guardia seems to have increased its share of traffic over the other airports in the second half of the year.

```{r}
ggplot(data=flt_1, 
aes(x= factor(month))) +
geom_bar( aes(fill= factor(carrier_name)))+
ggtitle ("Flight volumes by departure airports across months") +
theme(legend.position="top") +
theme_dark() +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))+
coord_flip()
```
**ANALYSIS**

As we see in the analysis that the carrier spread is consistent across month and days. We can see

- variability in the number of Flights among different airlines
- But No clear difference in terms of the proportion of flights across the months.

# Q21. Overall Analysis of deep_delay over the course of the Year [2013-2014].
```{r}
# Write a function to extract using make_datetime.
datetime_func <- function(year, month, day, time) {
make_datetime(year, month, day, time %/% 100, time %% 100)
}

# Filter 
flights_dt <- flt_1 %>% 
filter(!is.na(dep_time), !is.na(arr_time)) %>% 
mutate(
dep_time = datetime_func(year, month, day, dep_time),
arr_time = datetime_func(year, month, day, arr_time),
sched_dep_time = datetime_func(year, month, day, sched_dep_time),
sched_arr_time =datetime_func(year, month, day, sched_arr_time)) %>% 
select(origin, dest, ends_with("delay"), ends_with("time"))

# Plot 
flights_dt %>% 
ggplot(aes(dep_time)) + 
geom_freqpoly(binwidth = 86400)+ # 86400 seconds = 1 day
ggtitle ("Analysis of deep_delay over the course of the year [2013-2014]") +
theme(legend.position="top") +
theme_dark() +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))

```
# Q22. Overall Analysis of deep_delay over the course of the Week.

```{r}
flights_dt %>% 
mutate(wday = wday(dep_time, label = TRUE)) %>% 
ggplot(aes(x = wday)) +
geom_bar(stat="count") +
ggtitle ("Analysis of deep_delay over the course of the Week") +
theme(legend.position="top") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

# Q23. Overall Analysis of deep_delay over the course of the day.
```{r}
flights_dt %>% 
filter(dep_time < ymd(20130102)) %>%  # On 2nd Jan 2013
ggplot(aes(dep_time)) + 
geom_freqpoly(binwidth = 600)+ # 600 s = 10 minutes
ggtitle ("Analysis of deep_delay over the day[Jan 1st- Jan 2nd]") +
theme(legend.position="top") +
theme_dark() +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))

```
# Q24. Overall Analysis of deep_delay over the hour [2013-2014]

```{r}
flights_dt %>% 
count(week = floor_date(dep_time, "week")) %>% 
ggplot(aes(week, n)) +
geom_line()+
ggtitle ("Average departure delays by minute within givin hour.") +
theme(legend.position="top") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
**ANALYSIS**

Average departure delay by minute within the hour. It looks like flights leaving in minutes 20-30 and 50-60 have much lower delays than the rest of the hour.

# Q25. How is the flights scheduled for the given airports?
```{r}
sched_dep <- flights_dt %>% 
mutate(minute = minute(sched_dep_time)) %>% 
group_by(minute) %>% 
summarise(
avg_delay = mean(arr_delay, na.rm = TRUE),
n = n())

ggplot(sched_dep, aes(minute, avg_delay)) +
geom_line()+
ggtitle ("scheduled departure time with arrival Delay.") +
theme(legend.position="top") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
**ANALYSIS** 

If we look at the scheduled departure time we don’t see such a strong pattern.

# Q26. Departur hour by Count

```{r}
flights_dt %>% 
mutate(dep_hour = update(dep_time, yday = 1)) %>% 
ggplot(aes(dep_hour)) +
geom_freqpoly(binwidth = 300)+
ggtitle ("Departure hour by Count") +
theme(legend.position="top") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15), color="#D70026",face="bold.italic" ),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

# Q27. Relationship between distance and arrival delay

```{r}
ggplot(flt_1, aes(distance, arr_delay, fill = arr_delay))+
geom_point(color = "steelblue") +
ggtitle ("Relationship between distance and arrival delay") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme_bw()+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

```{r}
# breakdown time_hour to year, month, day, hour,min, sec. I will show you both ways of converting date into Weekdays and the Week numbers.
date <- as.Date(flt_1$time_hour, format = "%Y-%m-%d %H:%M:%S" ) # This is old way of doing 
flt_1$weekday <- weekdays(date)
unique(flt_1$weekday)
flt_1$wdays<-ymd_hms(flt_1$time_hour) %>% wday() # This is new way of coding 
unique(flt_1$wdays) # 1 : Sunday by default and 7 : Saturday
flt_1<- flt_1 %>% mutate(week_d = ifelse(wdays %in% c(1,7), "weekend","weekdays")) # converting to wdays & weekend
table(flt_1$week_d) # sanity check
```

# Q28. Was there any difference between Arrival delays on weekends & during the week?

```{r}

print(" For Arrival Delays")
# Aggregate to see how many arr_delay happen during weekdays and weekends.
aggregate(flt_1$arr_delay ~ flt_1$week_d,
FUN = mean, 
na.rm = T)

print(" T-test For Arrival Delays")
t.test(arr_delay~ week_d, data = flt_1)


print(" For Departure Delays ")
# Aggregate to see how many dep_delay happen during weekdays and weekends.
aggregate(flt_1$dep_delay ~ flt_1$week_d,
FUN = mean, 
na.rm = T)

print(" T-test For Departure Delays")
t.test(dep_delay~ week_d, data = flt_1)
```
**ANALYSIS**

Comparison done by T-test.

# Q29. Linear Regression Analysis between two major airliness.

Linear Regression Model for Air time as a function of distance for two major carrier United Airways and Jet Blue.
```{r}
flights_per_carrier <- cbind (Frequency  = table(unique(flt_1$carrier)), 
RelFreq = prop.table (table(unique(flt_1$carrier))))

head(flights_per_carrier, 10) # Will show top 10 table

jet_blue <- subset(flt_1, carrier == 'B6')
united_air <- subset(flt_1, carrier == 'UA')

# Linear Regression 
air_time.lm.jet_blue <- lm(distance ~ arr_time, data = jet_blue)
air_time.lm.united_air <- lm(distance ~ arr_time, data = united_air)

plot (x = jet_blue$distance,y = jet_blue$arr_time,xlab = 'Distance [miles]',ylab = 'Air time [min]',main = 'Air time as a function of distance for two major carrier \n United Airways and Jet Blue',pch=18,col='green')
points (x = united_air$distance, y = united_air$arr_time,pch=22,col='red')
abline (air_time.lm.jet_blue , col = 'darkgreen')
abline (air_time.lm.united_air, col = 'darkred')

legend ('topleft',legend = c('United Airliness', 'Jet Blue'),col = c('red', 'green'),pch = 14)
```

# Q30. Relationship of Time with 3 other dependent variables.

```{r}
#Put the plots next to each other
par(mfrow = c(1, 3))

#First Plot - Distance
plot(x = flt_1$distance,y = flt_1$arr_time,main = "Time and Distance",xlab = "Distance in miles", ylab = "Arrival Time in minutes",xlim = c(0, 4000),ylim = c(0, 600), col = "lightcoral",pch = 18, type = "p",cex = 0.2)
abline(lm(flt_1$arr_time ~ flt_1$distance),col = "black",lty = 1)

# Second Plot - dep_delay
plot(x = flt_1$dep_delay,y = flt_1$arr_time,main = "Time and Departure Delay",xlab = "Delay of departure",ylab = "Arrival Time in Minutes",xlim = c(-33, 1000),ylim = c(0, 600),col = "skyblue", pch = 11,type = "p",cex = 0.5)
abline(lm(flt_1$arr_time ~ flt_1$dep_delay),col = "black",lty = 1)

# Third Plot - arr_delay
plot(x = flt_1$arr_delay,y = flt_1$arr_time,main = "Time and Arrival Delay",xlab = "Delay of arrival",ylab = "Arrival Time in Minutes",xlim = c(-70, 1000),ylim = c(0, 600), col = "cyan3",pch = 11, type = "p",cex = 0.5)
abline(lm(flt_1$arr_time ~ flt_1$arr_delay),col = "black",lty = 1)
```

Below We will create a histogram which will show how many flights were taken in each hour throughout the year.
```{r}
hist(x = flt_1$hour,main = "Flights per hour over the year", xlab = "Hour",ylab = "Number of flights",col = "aliceblue",border = "black",xlim = c(0,24),ylim = c(0,20000),breaks = seq(0,24, by = 1))
abline(v = median(flt_1$hour, na.rm = T),col = "black",lwd = 3,lty = 1)
text(x = 16,y = 20000,labels = "Median", lwd = 2)
abline(v = mean(flt_1$hour, na.rm = T),col = "indianred4",lwd = 3, lty = 1)
text(x = 12,y = 20000, labels = "Mean",lwd = 2,col = "indianred4")
```
+ Choose top three Carriers based on number from three airports interms of flights.  

a. United Airliness (UA)
b. JetBlue(B6)  
c. Express Jet Airliness (EV)

# Q31. Dive deep into three specific Airliness.

```{r}
```

In order to look deeper into our findings, we chose 3 airline companies: 
- United Airlines (UA)
- JetBlue(B6)) 
- Express Jet Airlines (EV) 

out of the 16 carriers that fly out of NYC. The 3 airlines selected are typically categorized into the same market positon: budget airlines, which allows us to meaningfully compare and contrast their performance.
Let's make a subset of budget airlines where we will choose the top three carriers.
```{r}
budget_flights <- flt_1 %>% 
filter(carrier == 'UA'|carrier == 'B6'|carrier == 'EV')
# head(budget_flights) # Uncomment to see the top of the budget airliness.
```
# Q32. Summaries within airports from chosen three flights.

A horizontal comparison among budget airlines within different airports displays the following results:
```{r}
ggplot(data = budget_flights) + 
aes(x= factor(origin)) + 
geom_bar(aes(fill= factor(carrier_name)))
```
**ANALYSIS**

- We can see Jetblue has large share in JFK Airport. 
- Delta has roughly similar number of flights in JFK and LGA but very less from Newark Liberty Airport.

# Q33. Overall Share in Mosiac plot 
The share of flights among airports can be presented more easily in the output below:
```{r}
xtabs(data=budget_flights, 
formula=~ factor(origin) + 
factor(carrier))
mosaic(formula= factor(origin)~ factor(carrier),
data=budget_flights, gp = shading_hcl, gp_args = list(interpolate = c(1, 1.8)))
```

**ANALYSIS**

+ JetBlue has a larger share of its flights in JFK.
+ Delta has most of its flights in JFK and LGA. (Roughly equal distribution)

+ Summaries among delays

The following strip plot shows a comparison output of the three airlines on their performance of depature delay time:
```{r}
ggplot(data=budget_flights, 
aes(x=dep_delay, 
y= factor(carrier_name))) + 
geom_point( aes(color= factor(carrier_name)), 
size=1, 
position= position_jitter(height=0.4))+
ggtitle ("Relationship between carrier and departure delay") +
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme_bw()+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```


We have to spend a lot of Exploratory work on finding out there are delays in arrival, departure not only in one season but every season throughout the year. We tried to correlate it with various factors but without analyzing with weather datasets our reports will be incomplete so let's see the effects our delays with the weather datasets.

# Q34. Relationship between Weather and Departure delays.

```{r}
weather_n_flights <- flights %>%
mutate(dep_delay_by_hr = dep_delay/60) %>% # Convert it into Hour as all our datas are in minute
select(origin, year, month, day, hour, dep_delay_by_hr) %>% # Select the specfic columns
inner_join(weather, by = c("origin", "year", "month", "day", "hour"))
# glimpse(weather_n_flights) # Uncomment to see the weathe and flights datasets have been merged well.
```

After merging two datasets, let's Look into the visibility factor which is major of airlines to operate smoothly.

-  **Visibility:** Visibility is a measure of the distance at which an object or light can be clearly discerned. Visibility may vary according to the direction and angle of view, and the height of the observer. Visibility is affected by the presence of fog, cloud, haze, and precipitation.

# Q35. Trend in mean departure delay by visibility
```{r}
weather_n_flights %>% # Inner Join Weather with flights
select(dep_delay_by_hr, visib) %>% # Select only column of our interest i.e delay and visibility
filter(!is.na(dep_delay_by_hr) & !is.na(visib)) %>% # Filter out the missing datas
ggplot(aes(x = visib, y = dep_delay_by_hr)) + # Plot the graph
geom_smooth() +
theme_bw(base_size = 16) +
xlab("Visibility (miles)") + # X label 
ylab("Average departure delay (hours)") + # Y- label
ggtitle("Trend in mean departure delay by visibility") + # Title
theme(plot.title=element_text(size=12))+ # Size and theme
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))

```
**ANALYSIS**

Aircraft departure and arrival is limited by the visibility (or RVR) to an extent that depends on the sophistication of ground equipment, the technical equipment fitted to the aircraft and the qualification of the flight crew. Many aerodromes and aircraft are fitted with equipment that makes possible a landing in very low visibility conditions provided the flight crew is suitably qualified; however, in very low visibility, it may prove impossible for the pilot to navigate the aircraft along the runway and taxiways to the aircraft stand.

# Q36. Relationship between Pressure and Departure delays
```{r}
flights %>%
select(origin, dest, year, month, day, hour, dep_delay, arr_delay) %>%
inner_join(weather, by = c("origin", "year", "month", "day", "hour")) %>%
select(dep_delay, pressure) %>%
filter(!is.na(dep_delay) & !is.na(pressure)) %>% 
ggplot(aes(x = pressure, y = dep_delay)) +
geom_smooth() +
theme_bw(base_size = 10) +
xlab("Sea-level Pressure at departure hour (millibars)") +
ylab("Average departure delay (minutes)") +
ggtitle("Impact of Sea-level Pressure on Departure Delays")+
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah")+
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
Let's pick one of the destinations in mid to long-haul flights to see the effects of Weather because on the short flight it will be hard to correlate the true findings. So just for a sake of the impact we can choose San Francisco as a final destination and see the variability in the speed.

# Q37. Speeds by carrier 
**Take an example of flights from east coast NYC to San-diego.**
```{r}
flights %>%
filter(dest == 'SAN') %>%
left_join(planes, by = "tailnum") %>%
left_join(airlines, by = "carrier") %>%
mutate(milesperminute = distance / air_time,
milesperhour = milesperminute * 60) %>%
ggplot(aes(x = carrier, y = milesperhour, fill = carrier)) +
geom_boxplot() +
guides(fill=FALSE) +
ggtitle("New York-San Diego: Speeds by Carrier") +
ylab("Miles Per Hour") +
coord_flip()+
scale_x_discrete(breaks=c("AA", "B6", "DL", "UA"),
labels=c("American Airlines", "JetBlue Airways", # two are our budget airlines & two i choose as a control so that we are not bias in our datasets out of 16.
"Delta Air Lines", "United Airlines"))+
theme(plot.title=element_text(size=12))+ # Size and theme
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```
# Q38. Delays in flights to Midwest St. Louis by time of day 

Just not to be bias I will choose one more flight somewhere in midwest to see the effects.
```{r}
# Also we choose different airliness as we have choosen for the west coast airliness.
flights %>%
filter (dest == "STL") %>%
left_join(airlines) %>%
mutate(dep_delay_hours = (dep_delay/60)) %>%
filter(dep_delay_hours < 10 & carrier %in% c("AA", "EV", "WN", "MQ")) %>%
ggplot(aes(x = hour, y = dep_delay_hours, color = name))+
facet_wrap( ~ name) +
geom_point () +
xlab ("Hour of the Day") +
ylab ("Departure Delay (Hours)") +
geom_line(stat = "smooth", method = "loess" , aes(group = name, color = name)) +
theme_bw() +
scale_color_manual(name = "Airline",
values = c("American Airlines Inc." = "royalblue4",
"DeltaAir Lines Inc." = "blue4",
"Envoy Air" = "springgreen4",
"ExpressJet Airlines Inc." = "yellow",
"Southwest Airlines Co." = "orange",
"United Air Lines Inc." = "skyblue")) +
guides(color=FALSE) +
ggtitle("Delays in flights to Midwest St. Louis by time of day")+
theme(plot.title=element_text(size=12))+ # Size and theme
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

Drilling down to NYC airport for United Airliness.

# Q39. United's delays by NYC airport.

```{r}
flights %>%
rename(destination = dest,
departure_delay = dep_delay,
arrival_delay = arr_delay,
time_in_air = air_time) %>%
select(-year, -dep_time, -arr_time, -tailnum,
-flight, -hour, -minute, -day) %>%
mutate(ind_delayed_dep = ifelse(departure_delay > 0, 1, 0),
ind_delayed_arr = ifelse(arrival_delay > 0, 1, 0)) %>%
left_join(airlines, by = "carrier") %>%
group_by(origin, name) %>%
filter(carrier == "UA") %>%
summarise(n_obs = n(),
per_delayed_dep = round(sum(ind_delayed_dep, na.rm=TRUE) / n(),2),
per_delayed_arr = round(sum(ind_delayed_arr, na.rm=TRUE) / n(),2)) %>%
rename(Airport = origin,
`Carrier Name` = name,
`Number of Flights` = n_obs,
`Proportion with Departure Delays` = per_delayed_dep,
`Proportion with Arrival Delays` = per_delayed_arr) %>%
pander(style = "rmarkdown", split.tables = 200)
```
# Q40. Departure delays by month 

```{r}
months_Str <- c("JAN","FEB","MAR","APR","MAY","JUN",
"JUL","AUG","SEP","OCT","NOV","DEC")

flights %>%
filter(!is.na(dep_delay) & !is.na(month)) %>%
group_by(month) %>%
summarise(mean_dep_delay = mean(dep_delay)) %>%
# make month categorical by wrapping factor() around it and telling it the underlying labels
ggplot(aes(x = factor(month, labels = months_Str),
y = mean_dep_delay)) +
# rainbow colors on the bars, but not related to the values so not inside an aes(). color = "black" does the outline
geom_bar(stat = "identity", fill = rainbow(12), color = "black") +
xlab("Month") +
ylab("Time (minutes)") +
ggtitle("Average delayed departure time by month")+
theme(plot.title=element_text(size=12))+ # Size and theme
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

# Q41. How many seats are on a plane?

```{r}
data_manufacturer <- flights %>%
select(carrier, tailnum) %>%
left_join(airlines, by = "carrier") %>%
inner_join(planes, by = "tailnum") %>%
# let's group Airbus and Airbus Industries into one category
mutate(makers = ifelse((manufacturer == "AIRBUS" | manufacturer == "AIRBUS INDUSTRIE"), "AIRBUS", as.character(manufacturer))) 

# set up a vector of the top 3 within a list
list <- c("AIRBUS","BOEING","EMBRAER")

# how has the number of seats per plane changed over time?  
ggplot(data = data_manufacturer %>%
# filter to just the top 3 using the "in" function 
filter(makers %in% list) %>% 
select(makers, year, seats) %>%
# just need one row per maker-year-seat
# (many duplicates on the data!)
distinct(makers, year, seats),
aes(x = year, y=seats, color = makers)) +
geom_point() +
theme_light() + xlab("years") + ylab("number of seats") +
ggtitle("How has number of seats per plane changed over time?")+
theme(plot.title=element_text(size=12))+ # Size and theme
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

# Q42. Ovearll Stastical delays by month

```{r}
by_month <- group_by(nycflights,month)
dep_delay_month <- summarise(by_month, Mean = round(mean(dep_delay),digits = 2),
Median = round(median(dep_delay),digits = 2),
IQR = IQR(dep_delay),
MAX = max(dep_delay)
)
arrange(dep_delay_month,desc(Mean))
```
By knowing all the statistical numbers like the mean or the median a more reliable measure for deciding which month(s) to avoid flying if you really dislike delayed flights.

# Q43. On time departure rate for NYC airports

```{r}
nycflights_on_time <- nycflights %>%
mutate(dep_type = ifelse(dep_delay < 5, "on time", "delayed"))

nycflights_on_time  %>%
group_by(origin) %>%
summarise(ot_dep_rate = sum(dep_type == "on time") / n()) %>%
arrange(desc(ot_dep_rate))
```

If you were selecting an airport simply based on on time departure percentage, LGA airport would be best tof fly out.

```{r}
# nycflights_on_time <- nycflights_on_time %>% 
#         mutate(ontime = dep_delay < 5)
# 
# nycflights_on_time %>% 
#   group_by(origin) %>% 
#   summarise(ontime_prop = sum(ontime == TRUE) / n()) %>%
#   arrange(desc(ontime_prop))
```

# Q44. Overall Delayed and Ontime flights 

```{r}
ggplot(data = nycflights_on_time, aes(x = origin, fill = dep_type)) +
geom_bar()+
ggtitle("Overall Delayed and Ontime flights ") + # Title
theme(plot.title=element_text(size=12))+ # Size and theme
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

#Q45. Average Speed of the Airplanes 

```{r}
nycflights <- nycflights %>% mutate(avg_speed = distance / (arr_time/60))
ggplot(data = nycflights, aes(distance,avg_speed)) + geom_point()+
ggtitle("Average Speed of the Airliness ") + # Title
theme(plot.title=element_text(size=12))+ # Size and theme
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

The reason could be that with longer distances the start and landing time does not count so heavy as with short distances. There is one exception fast flight from LaGuardia to Atlanta. The very far flight distances (the points on the 5.000 miles distance rage) are FROM NYC to Honolulu (HNL), the shortest to Philadelphia (PHL).

```{r}
dl_aa_ua <- nycflights %>%
filter(carrier == "AA" | carrier == "DL" | carrier == "UA")

ggplot(dl_aa_ua, aes(x = dep_delay, y = arr_delay, color = carrier)) +
xlim(-25, 100) +
geom_point()+
ggtitle("Relationship between Arrival and departure delays ") + # Title
theme(plot.title=element_text(size=12))+ # Size and theme
labs(caption = "Source: NYC-FLIGHTS  datasets | @ Pankaj Shah") +
theme(
axis.line.x = element_line(size = 0.5, colour = "black"),
axis.line.y = element_line(size = 0.5, colour = "black"),
axis.line = element_line(size=1, colour = "black"),
panel.grid.major = element_blank(),
panel.grid.minor = element_blank(),
panel.border = element_blank(),
panel.background = element_rect(size = 0.5, linetype = "solid"),
plot.caption=element_text(size=9.5, hjust=1.0, margin=margin(t= 15),color="#D70026",face="bold.italic"),
plot.title = element_text(color="black", size=14, face="bold.italic", hjust = 0.5),
axis.title.x = element_text(color="blue", size=14, face="bold"),
axis.title.y = element_text(color="#993333", size=14, face="bold"))
```

# Q46 How many planes were late than 5 Minutes.

```{r}
nycflights <- nycflights %>% 
mutate(ontime = dep_delay < 5)
nycflights <- nycflights %>%
mutate(arr_type = ifelse(dep_delay < 5, "on time", "delayed"))

nycflights %>% group_by(origin) %>% summarise(ontime_prop_1 = sum(arr_type == 'delayed') / n()) %>% 
arrange(desc(ontime_prop_1))
```

# Q47. Analysing on Single Plane 

```{r}
singleplane <- filter(flights, tailnum=="N355NB") %>% 
select(year, month, day, dest, origin, distance) 
head(singleplane)
sum(singleplane$distance)
dim(singleplane)
```

# Q48. Looking other components of Weather on flight Datasets.

```{r}
head(weather)
avgdelay <- flights %>%
group_by(month, day) %>%
filter(month < 13) %>%
summarise(avgdelay = mean(arr_delay, na.rm=TRUE)) 
precip <- weather %>%
group_by(month, day) %>%
filter(month < 13) %>%
summarise(totprecip = sum(precip), maxwind = max(wind_speed))
precip <- mutate(precip, anyprecip = ifelse(totprecip==0, "No", "Yes"))
merged <- left_join(avgdelay, precip, by=c("day", "month"))
head(merged)
```

# Take Home Message:

One thing to consider living in east coast during winter month is that Snowstorms are the most frequent instigators of massive flight delays and cancelations at the metro's big three airports, but aren't the only weather nuisance. Situated on Flushing Bay, storm surge from flood LaGuardia's runways, which can push as far as the terminal buildings and jetways. Fortunately, many planes can be moved ahead of time if the weather is known beforehand to other airports as a precaution. Flights will not resume until couple days later which might affect many flights. A line of thunderstorms ahead of an advancing cold front into the Northeast can also trigger significant flight delays on the order of several hours. Fortunately, thunderstorm days (24 to 26 each year, on average), aren't nearly as numerous as, say, Houston, Denver or Atlanta so we didn't see those effect on our datasets.


Of course, it's not just rain or snow that can delay your flight to the Big Apple. Low clouds and fog can trigger big delays. We can analyze further in details if time and situation permit to find more about wind delays at these airports. Two of Newark’s three runways are oriented southwest to northeast. Since west to northwest crosswinds are common, this can be a frequent problem, even on sunny days. Winds can create headaches for pilots attempting to land, which is why we see planes circling EWR on lots of news article for delays around the month of June and July. Security accounted for a relatively low percentage —0.1%—of delay minutes for U.S. airlines according to most of the journals. Security reasons range from an evacuation of a terminal or concourse, reboarding of aircraft because of the security breach, inoperative screening equipment or long lines at screening areas in excess of mostly within an hour. Canceling flights due to weather is at the judgment of the carrier. Common causes of delays include tornados, blizzards, and hurricanes. National Aviation System (NAS) delays refer to a broad set of conditions including non-extreme weather, airport operations, heavy traffic volume, and air traffic control. These cancellations or delays are related to circumstances within the airline’s control, including maintenance or crew problems, aircraft cleaning, baggage loading, and fueling. The most common cause of delays is late-arriving aircraft, which accounted for 41.9% of total tardiness minutes in 2014. This situation causes a ripple effect on other flights. 

```{r}

```

THANK YOU!!!

```{r}

```

ts as a precaution. Flights will not resume until couple days later which might affect many flights. A line of thunderstorms ahead of an advancing cold front into the Northeast can also trigger significant flight delays on the order of several hours. Fortunately, thunderstorm days (24 to 26 each year, on average), aren't nearly as numerous as, say, Houston, Denver or Atlanta so we didn't see those effect on our datasets.


Of course, it's not just rain or snow that can delay your flight to the Big Apple. Low clouds and fog can trigger big delays. We can analyze further in details if time and situation permit to find more about wind delays at these airports. Two of Newark’s three runways are oriented southwest to northeast. Since west to northwest crosswinds are common, this can be a frequent problem, even on sunny days. Winds can create headaches for pilots attempting to land, which is why we see planes circling EWR on lots of news article for delays around the month of June and July. Security accounted for a relatively low percentage —0.1%—of delay minutes for U.S. airlines according to most of the journals. Security reasons range from an evacuation of a terminal or concourse, reboarding of aircraft because of the security breach, inoperative screening equipment or long lines at screening areas in excess of mostly within an hour. Canceling flights due to weather is at the judgment of the carrier. Common causes of delays include tornados, blizzards, and hurricanes. National Aviation System (NAS) delays refer to a broad set of conditions including non-extreme weather, airport operations, heavy traffic volume, and air traffic control. These cancellations or delays are related to circumstances within the airline’s control, including maintenance or crew problems, aircraft cleaning, baggage loading, and fueling. The most common cause of delays is late-arriving aircraft, which accounted for 41.9% of total tardiness minutes in 2014. This situation causes a ripple effect on other flights. 

```{r}

```

THANK YOU!!!

```{r}

```

